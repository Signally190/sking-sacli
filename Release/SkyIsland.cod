; Listing generated by Microsoft (R) Optimizing Compiler Version 19.29.30133.0 

	TITLE	\\VBOXSVR\_stoneage\repos\ssm-sacli\Release\SkyIsland.obj
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?sky_island_no@@3KA				; sky_island_no
PUBLIC	?sky_island_no_bak@@3KA				; sky_island_no_bak
PUBLIC	?lpsurLand@@3PAUIDirectDrawSurface@@A		; lpsurLand
PUBLIC	?lpsurCloud1@@3PAUIDirectDrawSurface@@A		; lpsurCloud1
PUBLIC	?lpsurCloud2@@3PAUIDirectDrawSurface@@A		; lpsurCloud2
PUBLIC	?moonFlag@@3HA					; moonFlag
PUBLIC	?NCLOUD_Flag@@3HA				; NCLOUD_Flag
PUBLIC	?LandWidth@@3FA					; LandWidth
PUBLIC	?LandHeight@@3FA				; LandHeight
PUBLIC	?CloudWidth1@@3FA				; CloudWidth1
PUBLIC	?CloudHeight1@@3FA				; CloudHeight1
PUBLIC	?CloudWidth2@@3FA				; CloudWidth2
PUBLIC	?CloudHeight2@@3FA				; CloudHeight2
PUBLIC	?fMapWidth@@3HA					; fMapWidth
PUBLIC	?fMapHeight@@3HA				; fMapHeight
PUBLIC	?iCloudX1@@3HA					; iCloudX1
PUBLIC	?iCloudY1@@3HA					; iCloudY1
PUBLIC	?iCloudX2@@3HA					; iCloudX2
PUBLIC	?iCloudY2@@3HA					; iCloudY2
PUBLIC	?iCloudDX@@3HA					; iCloudDX
PUBLIC	?iCloudDY@@3HA					; iCloudDY
PUBLIC	?bDrawUpCloud@@3HA				; bDrawUpCloud
PUBLIC	?g_rc@@3UtagRECT@@A				; g_rc
_BSS	SEGMENT
?sky_island_no@@3KA DD 01H DUP (?)			; sky_island_no
?sky_island_no_bak@@3KA DD 01H DUP (?)			; sky_island_no_bak
?lpsurLand@@3PAUIDirectDrawSurface@@A DD 01H DUP (?)	; lpsurLand
?lpsurCloud1@@3PAUIDirectDrawSurface@@A DD 01H DUP (?)	; lpsurCloud1
?lpsurCloud2@@3PAUIDirectDrawSurface@@A DD 01H DUP (?)	; lpsurCloud2
?moonFlag@@3HA DD 01H DUP (?)				; moonFlag
?NCLOUD_Flag@@3HA DD 01H DUP (?)			; NCLOUD_Flag
?LandWidth@@3FA DW 01H DUP (?)				; LandWidth
	ALIGN	4

?LandHeight@@3FA DW 01H DUP (?)				; LandHeight
	ALIGN	4

?CloudWidth1@@3FA DW 01H DUP (?)			; CloudWidth1
	ALIGN	4

?CloudHeight1@@3FA DW 01H DUP (?)			; CloudHeight1
	ALIGN	4

?CloudWidth2@@3FA DW 01H DUP (?)			; CloudWidth2
	ALIGN	4

?CloudHeight2@@3FA DW 01H DUP (?)			; CloudHeight2
	ALIGN	4

?fMapWidth@@3HA DD 01H DUP (?)				; fMapWidth
?fMapHeight@@3HA DD 01H DUP (?)				; fMapHeight
?iCloudX1@@3HA DD 01H DUP (?)				; iCloudX1
?iCloudY1@@3HA DD 01H DUP (?)				; iCloudY1
?iCloudX2@@3HA DD 01H DUP (?)				; iCloudX2
?iCloudY2@@3HA DD 01H DUP (?)				; iCloudY2
?iCloudDX@@3HA DD 01H DUP (?)				; iCloudDX
?iCloudDY@@3HA DD 01H DUP (?)				; iCloudDY
?bDrawUpCloud@@3HA DD 01H DUP (?)			; bDrawUpCloud
?g_rc@@3UtagRECT@@A DB 010H DUP (?)			; g_rc
_BSS	ENDS
PUBLIC	?SkyIslandDraw@@YAXH@Z				; SkyIslandDraw
PUBLIC	?LoadBmpToSurface@@YAXHPAUIDirectDrawSurface@@HH@Z ; LoadBmpToSurface
PUBLIC	?SkyIslandInit@@YAXXZ				; SkyIslandInit
PUBLIC	?SkyIslandRelease@@YAXXZ			; SkyIslandRelease
PUBLIC	?SkyIslandLoadBmp@@YAXXZ			; SkyIslandLoadBmp
PUBLIC	?SkyIslandSetNo@@YAXH@Z				; SkyIslandSetNo
PUBLIC	?SkyIslandDraw2@@YAXH@Z				; SkyIslandDraw2
PUBLIC	?SkyIslandCheckSurface@@YAHXZ			; SkyIslandCheckSurface
PUBLIC	?SkyIslandProc@@YAXXZ				; SkyIslandProc
EXTRN	__Init_thread_header:PROC
EXTRN	__Init_thread_abort:PROC
EXTRN	__Init_thread_footer:PROC
EXTRN	?TimeGetTime@@YAIXZ:PROC			; TimeGetTime
EXTRN	__imp__SetRect@20:PROC
EXTRN	_rand:PROC
EXTRN	?CreateSurface@@YAPAUIDirectDrawSurface@@FFKI@Z:PROC ; CreateSurface
EXTRN	?realGetImage@@YAHHPAPAEPAH1@Z:PROC		; realGetImage
EXTRN	?realGetWH@@YAHKPAF0@Z:PROC			; realGetWH
EXTRN	?realGetNo@@YAHKPAK@Z:PROC			; realGetNo
EXTRN	@__security_check_cookie@4:PROC
EXTRN	___CxxFrameHandler3:PROC
EXTRN	_memcpy:PROC
EXTRN	_memset:PROC
EXTRN	__Init_thread_epoch:DWORD
EXTRN	?lpDraw@@3PAUDIRECT_DRAW@@A:DWORD		; lpDraw
EXTRN	?DEF_APPSIZEX@@3HA:DWORD			; DEF_APPSIZEX
EXTRN	?DEF_APPSIZEY@@3HA:DWORD			; DEF_APPSIZEY
EXTRN	?pRealBinBits@@3PADA:DWORD			; pRealBinBits
EXTRN	?RealBinWidth@@3HA:DWORD			; RealBinWidth
EXTRN	?RealBinHeight@@3HA:DWORD			; RealBinHeight
EXTRN	?nowFloorGxSize@@3HA:DWORD			; nowFloorGxSize
EXTRN	?nowFloorGySize@@3HA:DWORD			; nowFloorGySize
EXTRN	?nowGx@@3HA:DWORD				; nowGx
EXTRN	?nowGy@@3HA:DWORD				; nowGy
EXTRN	?pc@@3UPC@@A:BYTE				; pc
EXTRN	?displayBpp@@3HA:DWORD				; displayBpp
EXTRN	?highColorPalette@@3PAGA:BYTE			; highColorPalette
EXTRN	?highColor32Palette@@3PAIA:BYTE			; highColor32Palette
EXTRN	___security_cookie:DWORD
EXTRN	__tls_array:DWORD
EXTRN	__tls_index:DWORD
;	COMDAT ?dwSlow1@?1??SkyIslandDraw@@YAXH@Z@4KA
_BSS	SEGMENT
?dwSlow1@?1??SkyIslandDraw@@YAXH@Z@4KA DD 01H DUP (?)	; `SkyIslandDraw'::`2'::dwSlow1
_BSS	ENDS
;	COMDAT ?compx@?1??SkyIslandDraw@@YAXH@Z@4HA
_BSS	SEGMENT
?compx@?1??SkyIslandDraw@@YAXH@Z@4HA DD 01H DUP (?)	; `SkyIslandDraw'::`2'::compx
_BSS	ENDS
;	COMDAT ?$TSS0@?1??SkyIslandDraw@@YAXH@Z@4HA
_BSS	SEGMENT
?$TSS0@?1??SkyIslandDraw@@YAXH@Z@4HA DD 01H DUP (?)	; `SkyIslandDraw'::`2'::$TSS0
_BSS	ENDS
;	COMDAT ?compy@?1??SkyIslandDraw@@YAXH@Z@4HA
_BSS	SEGMENT
?compy@?1??SkyIslandDraw@@YAXH@Z@4HA DD 01H DUP (?)	; `SkyIslandDraw'::`2'::compy
_BSS	ENDS
;	COMDAT ?$TSS1@?1??SkyIslandDraw@@YAXH@Z@4HA
_BSS	SEGMENT
?$TSS1@?1??SkyIslandDraw@@YAXH@Z@4HA DD 01H DUP (?)	; `SkyIslandDraw'::`2'::$TSS1
_BSS	ENDS
;	COMDAT ?dwSlow2@?1??SkyIslandDraw2@@YAXH@Z@4KA
_BSS	SEGMENT
?dwSlow2@?1??SkyIslandDraw2@@YAXH@Z@4KA DD 01H DUP (?)	; `SkyIslandDraw2'::`2'::dwSlow2
_BSS	ENDS
;	COMDAT ?speed@?1??SkyIslandProc@@YAXXZ@4KA
_BSS	SEGMENT
?speed@?1??SkyIslandProc@@YAXXZ@4KA DD 01H DUP (?)	; `SkyIslandProc'::`2'::speed
_BSS	ENDS
;	COMDAT xdata$x
xdata$x	SEGMENT
__unwindtable$?SkyIslandDraw@@YAXH@Z DD 0ffffffffH
	DD	FLAT:__unwindfunclet$?SkyIslandDraw@@YAXH@Z$0
	DD	0ffffffffH
	DD	FLAT:__unwindfunclet$?SkyIslandDraw@@YAXH@Z$1
__ehfuncinfo$?SkyIslandDraw@@YAXH@Z DD 019930522H
	DD	02H
	DD	FLAT:__unwindtable$?SkyIslandDraw@@YAXH@Z
	DD	2 DUP(00H)
	DD	2 DUP(00H)
	DD	00H
	DD	00H
xdata$x	ENDS
; Function compile flags: /Ogtp
; File \\VBOXSVR\_stoneage\repos\ssm-sacli\system\SkyIsland.cpp
;	COMDAT ?SkyIslandProc@@YAXXZ
_TEXT	SEGMENT
?SkyIslandProc@@YAXXZ PROC				; SkyIslandProc, COMDAT

; 530  : 	static DWORD speed = 0;
; 531  : 	if( sky_island_no){

  00000	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?sky_island_no@@3KA, 0 ; sky_island_no
  00007	74 5b		 je	 SHORT $LN5@SkyIslandP

; 532  : 		DWORD now = TimeGetTime();

  00009	e8 00 00 00 00	 call	 ?TimeGetTime@@YAIXZ	; TimeGetTime

; 533  : 		if( now > speed){

  0000e	3b 05 00 00 00
	00		 cmp	 eax, DWORD PTR ?speed@?1??SkyIslandProc@@YAXXZ@4KA
  00014	76 4e		 jbe	 SHORT $LN5@SkyIslandP

; 534  : 			speed = now + 1000;

  00016	56		 push	 esi
  00017	05 e8 03 00 00	 add	 eax, 1000		; 000003e8H

; 535  : 			int dx = 0, dy = 0;

  0001c	33 f6		 xor	 esi, esi
  0001e	57		 push	 edi
  0001f	a3 00 00 00 00	 mov	 DWORD PTR ?speed@?1??SkyIslandProc@@YAXXZ@4KA, eax
  00024	33 ff		 xor	 edi, edi

; 536  : 			switch( rand() & 0x3){

  00026	e8 00 00 00 00	 call	 _rand
  0002b	83 e0 03	 and	 eax, 3
  0002e	2b c7		 sub	 eax, edi
  00030	74 11		 je	 SHORT $LN6@SkyIslandP
  00032	83 e8 01	 sub	 eax, 1
  00035	74 16		 je	 SHORT $LN2@SkyIslandP

; 539  : 				break;
; 540  : 			case 1:
; 541  : 				break;
; 542  : 			default:
; 543  : 				dy = rand() & 0x2;

  00037	e8 00 00 00 00	 call	 _rand
  0003c	8b f8		 mov	 edi, eax
  0003e	83 e7 02	 and	 edi, 2
  00041	eb 0a		 jmp	 SHORT $LN2@SkyIslandP
$LN6@SkyIslandP:

; 537  : 			case 0:
; 538  : 				dx = rand() & 0x2;

  00043	e8 00 00 00 00	 call	 _rand
  00048	8b f0		 mov	 esi, eax
  0004a	83 e6 02	 and	 esi, 2
$LN2@SkyIslandP:

; 544  : 				break;
; 545  : 			}
; 546  : 			iCloudDX = 4 - dx;

  0004d	b9 04 00 00 00	 mov	 ecx, 4

; 547  : 			iCloudDY = 2 + dy;

  00052	8d 47 02	 lea	 eax, DWORD PTR [edi+2]
  00055	2b ce		 sub	 ecx, esi
  00057	a3 00 00 00 00	 mov	 DWORD PTR ?iCloudDY@@3HA, eax ; iCloudDY
  0005c	5f		 pop	 edi
  0005d	89 0d 00 00 00
	00		 mov	 DWORD PTR ?iCloudDX@@3HA, ecx ; iCloudDX
  00063	5e		 pop	 esi
$LN5@SkyIslandP:

; 548  : 		}
; 549  : 	}
; 550  : }

  00064	c3		 ret	 0
?SkyIslandProc@@YAXXZ ENDP				; SkyIslandProc
_TEXT	ENDS
; Function compile flags: /Ogtp
; File \\VBOXSVR\_stoneage\repos\ssm-sacli\system\SkyIsland.cpp
;	COMDAT ?SkyIslandCheckSurface@@YAHXZ
_TEXT	SEGMENT
?SkyIslandCheckSurface@@YAHXZ PROC			; SkyIslandCheckSurface, COMDAT

; 519  : 	if( lpsurLand)

  00000	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?lpsurLand@@3PAUIDirectDrawSurface@@A ; lpsurLand
  00006	85 c9		 test	 ecx, ecx
  00008	74 0a		 je	 SHORT $LN3@SkyIslandC

; 520  : 		if( lpsurLand->IsLost() )

  0000a	8b 01		 mov	 eax, DWORD PTR [ecx]
  0000c	51		 push	 ecx
  0000d	ff 50 60	 call	 DWORD PTR [eax+96]
  00010	85 c0		 test	 eax, eax
  00012	75 14		 jne	 SHORT $LN7@SkyIslandC
$LN3@SkyIslandC:

; 521  : 			return TRUE;
; 522  : 	if( lpsurCloud1)

  00014	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?lpsurCloud1@@3PAUIDirectDrawSurface@@A ; lpsurCloud1
  0001a	85 c9		 test	 ecx, ecx
  0001c	74 10		 je	 SHORT $LN5@SkyIslandC

; 523  : 		if( lpsurCloud1->IsLost() )

  0001e	8b 01		 mov	 eax, DWORD PTR [ecx]
  00020	51		 push	 ecx
  00021	ff 50 60	 call	 DWORD PTR [eax+96]
  00024	85 c0		 test	 eax, eax
  00026	74 06		 je	 SHORT $LN5@SkyIslandC
$LN7@SkyIslandC:

; 524  : 			return TRUE;

  00028	b8 01 00 00 00	 mov	 eax, 1

; 526  : }

  0002d	c3		 ret	 0
$LN5@SkyIslandC:

; 525  : 	return FALSE;

  0002e	33 c0		 xor	 eax, eax

; 526  : }

  00030	c3		 ret	 0
?SkyIslandCheckSurface@@YAHXZ ENDP			; SkyIslandCheckSurface
_TEXT	ENDS
; Function compile flags: /Ogtp
; File \\VBOXSVR\_stoneage\repos\ssm-sacli\system\SkyIsland.cpp
;	COMDAT ?SkyIslandDraw2@@YAXH@Z
_TEXT	SEGMENT
tv368 = -32						; size = 4
_h$1 = -32						; size = 2
_w$2 = -28						; size = 2
tv367 = -24						; size = 4
_no$3 = -24						; size = 4
_rc$ = -20						; size = 16
__$ArrayPad$ = -4					; size = 4
_fl$ = 8						; size = 4
?SkyIslandDraw2@@YAXH@Z PROC				; SkyIslandDraw2, COMDAT

; 434  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 20	 sub	 esp, 32			; 00000020H
  00006	a1 00 00 00 00	 mov	 eax, DWORD PTR ___security_cookie
  0000b	33 c5		 xor	 eax, ebp
  0000d	89 45 fc	 mov	 DWORD PTR __$ArrayPad$[ebp], eax

; 435  : #ifdef _MOON_FAIRYLAND				// (不可开) ROG ADD 月之仙境
; 436  : 	if(moonFlag == TRUE)

  00010	83 3d 00 00 00
	00 01		 cmp	 DWORD PTR ?moonFlag@@3HA, 1 ; moonFlag
  00017	0f 84 3c 02 00
	00		 je	 $LN25@SkyIslandD

; 437  : 	return;
; 438  : #endif
; 439  : 
; 440  : 	static DWORD dwSlow2;
; 441  : 	DWORD now;
; 442  : 	RECT rc;
; 443  : 	if( bDrawUpCloud){

  0001d	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?bDrawUpCloud@@3HA, 0 ; bDrawUpCloud
  00024	0f 84 2f 02 00
	00		 je	 $LN25@SkyIslandD

; 444  : 		bDrawUpCloud = FALSE;
; 445  : 		if( sky_island_no && lpsurCloud2 
; 446  : #ifdef _NEW_CLOUD
; 447  : 			|| ( fl == 61000 || fl == 61100 )

  0002a	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?sky_island_no@@3KA, 0 ; sky_island_no
  00031	53		 push	 ebx
  00032	8b 5d 08	 mov	 ebx, DWORD PTR _fl$[ebp]
  00035	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?bDrawUpCloud@@3HA, 0 ; bDrawUpCloud
  0003f	74 09		 je	 SHORT $LN8@SkyIslandD
  00041	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?lpsurCloud2@@3PAUIDirectDrawSurface@@A, 0 ; lpsurCloud2
  00048	75 14		 jne	 SHORT $LN9@SkyIslandD
$LN8@SkyIslandD:
  0004a	81 fb 48 ee 00
	00		 cmp	 ebx, 61000		; 0000ee48H
  00050	74 0c		 je	 SHORT $LN9@SkyIslandD
  00052	81 fb ac ee 00
	00		 cmp	 ebx, 61100		; 0000eeacH
  00058	0f 85 fa 01 00
	00		 jne	 $LN33@SkyIslandD
$LN9@SkyIslandD:
  0005e	56		 push	 esi
  0005f	57		 push	 edi

; 448  : #endif
; 449  : 			){
; 450  : 			if( (now = TimeGetTime()) > dwSlow2){

  00060	e8 00 00 00 00	 call	 ?TimeGetTime@@YAIXZ	; TimeGetTime
  00065	8b 35 00 00 00
	00		 mov	 esi, DWORD PTR ?iCloudX2@@3HA ; iCloudX2
  0006b	3b 05 00 00 00
	00		 cmp	 eax, DWORD PTR ?dwSlow2@?1??SkyIslandDraw2@@YAXH@Z@4KA
  00071	0f 86 20 01 00
	00		 jbe	 $LN28@SkyIslandD

; 451  : 				dwSlow2 = now + 73;
; 452  : 				iCloudX2 += iCloudDX;

  00077	03 35 00 00 00
	00		 add	 esi, DWORD PTR ?iCloudDX@@3HA ; iCloudDX
  0007d	83 c0 49	 add	 eax, 73			; 00000049H

; 453  : 				iCloudY2 += iCloudDY;

  00080	8b 3d 00 00 00
	00		 mov	 edi, DWORD PTR ?iCloudDY@@3HA ; iCloudDY
  00086	03 3d 00 00 00
	00		 add	 edi, DWORD PTR ?iCloudY2@@3HA ; iCloudY2
  0008c	a3 00 00 00 00	 mov	 DWORD PTR ?dwSlow2@?1??SkyIslandDraw2@@YAXH@Z@4KA, eax
  00091	89 35 00 00 00
	00		 mov	 DWORD PTR ?iCloudX2@@3HA, esi ; iCloudX2
  00097	89 3d 00 00 00
	00		 mov	 DWORD PTR ?iCloudY2@@3HA, edi ; iCloudY2
  0009d	3b 35 00 00 00
	00		 cmp	 esi, DWORD PTR ?DEF_APPSIZEX@@3HA ; DEF_APPSIZEX

; 454  : 				if( (iCloudX2>=DEF_APPSIZEX) || //((iCloudX2+CloudWidth2)<0) ||

  000a3	7d 0c		 jge	 SHORT $LN12@SkyIslandD
  000a5	3b 3d 00 00 00
	00		 cmp	 edi, DWORD PTR ?DEF_APPSIZEY@@3HA ; DEF_APPSIZEY
  000ab	0f 8c ec 00 00
	00		 jl	 $LN11@SkyIslandD
$LN12@SkyIslandD:

; 455  : 					(iCloudY2>=DEF_APPSIZEY) /*|| ((iCloudY2+CloudHeight2)<0)*/){
; 456  : 					//产生一朵新的云
; 457  : 					DWORD no;
; 458  : #ifdef _NEW_CLOUD
; 459  : 					if( fl == 61000 || fl == 61100 ){

  000b1	81 fb 48 ee 00
	00		 cmp	 ebx, 61000		; 0000ee48H
  000b7	74 17		 je	 SHORT $LN15@SkyIslandD
  000b9	81 fb ac ee 00
	00		 cmp	 ebx, 61100		; 0000eeacH
  000bf	74 0f		 je	 SHORT $LN15@SkyIslandD

; 461  : 					}
; 462  : 					else
; 463  : 						realGetNo( 40500+(rand()&0x3), &no);

  000c1	e8 00 00 00 00	 call	 _rand
  000c6	83 e0 03	 and	 eax, 3
  000c9	05 34 9e 00 00	 add	 eax, 40500		; 00009e34H
  000ce	eb 16		 jmp	 SHORT $LN14@SkyIslandD
$LN15@SkyIslandD:

; 460  : 						realGetNo( 29077+(rand()%2), &no);

  000d0	e8 00 00 00 00	 call	 _rand
  000d5	25 01 00 00 80	 and	 eax, -2147483647	; 80000001H
  000da	79 05		 jns	 SHORT $LN35@SkyIslandD
  000dc	48		 dec	 eax
  000dd	83 c8 fe	 or	 eax, -2			; fffffffeH
  000e0	40		 inc	 eax
$LN35@SkyIslandD:
  000e1	05 95 71 00 00	 add	 eax, 29077		; 00007195H
$LN14@SkyIslandD:

; 464  : #else
; 465  : 					realGetNo( 40500+(rand()&0x3), &no);
; 466  : #endif
; 467  : 					short w, h;
; 468  : 					realGetWH( no, &w, &h);

  000e6	8d 4d e8	 lea	 ecx, DWORD PTR _no$3[ebp]
  000e9	51		 push	 ecx
  000ea	50		 push	 eax
  000eb	e8 00 00 00 00	 call	 ?realGetNo@@YAHKPAK@Z	; realGetNo
  000f0	8d 45 e0	 lea	 eax, DWORD PTR _h$1[ebp]
  000f3	50		 push	 eax
  000f4	8d 45 e4	 lea	 eax, DWORD PTR _w$2[ebp]
  000f7	50		 push	 eax
  000f8	ff 75 e8	 push	 DWORD PTR _no$3[ebp]
  000fb	e8 00 00 00 00	 call	 ?realGetWH@@YAHKPAF0@Z	; realGetWH

; 469  : 					if( w!=CloudWidth2 || h!=CloudHeight2){

  00100	66 8b 4d e4	 mov	 cx, WORD PTR _w$2[ebp]
  00104	83 c4 14	 add	 esp, 20			; 00000014H
  00107	66 8b 45 e0	 mov	 ax, WORD PTR _h$1[ebp]
  0010b	66 3b 0d 00 00
	00 00		 cmp	 cx, WORD PTR ?CloudWidth2@@3FA ; CloudWidth2
  00112	75 09		 jne	 SHORT $LN17@SkyIslandD
  00114	66 3b 05 00 00
	00 00		 cmp	 ax, WORD PTR ?CloudHeight2@@3FA ; CloudHeight2
  0011b	74 24		 je	 SHORT $LN16@SkyIslandD
$LN17@SkyIslandD:

; 470  : 						CloudWidth2 = w;
; 471  : 						CloudHeight2 = h;

  0011d	66 a3 00 00 00
	00		 mov	 WORD PTR ?CloudHeight2@@3FA, ax ; CloudHeight2

; 472  : 						LoadBmpToSurface( no, lpsurCloud2, w, h);

  00123	98		 cwde
  00124	50		 push	 eax
  00125	0f bf c1	 movsx	 eax, cx
  00128	50		 push	 eax
  00129	ff 35 00 00 00
	00		 push	 DWORD PTR ?lpsurCloud2@@3PAUIDirectDrawSurface@@A ; lpsurCloud2
  0012f	66 89 0d 00 00
	00 00		 mov	 WORD PTR ?CloudWidth2@@3FA, cx ; CloudWidth2
  00136	ff 75 e8	 push	 DWORD PTR _no$3[ebp]
  00139	e8 00 00 00 00	 call	 ?LoadBmpToSurface@@YAXHPAUIDirectDrawSurface@@HH@Z ; LoadBmpToSurface
  0013e	83 c4 10	 add	 esp, 16			; 00000010H
$LN16@SkyIslandD:

; 473  : 					}
; 474  : 					int dx = 0, dy = 0;

  00141	33 f6		 xor	 esi, esi
  00143	33 ff		 xor	 edi, edi

; 475  : 					switch( rand()%3){

  00145	e8 00 00 00 00	 call	 _rand
  0014a	99		 cdq
  0014b	b9 03 00 00 00	 mov	 ecx, 3
  00150	f7 f9		 idiv	 ecx
  00152	2b d6		 sub	 edx, esi
  00154	74 11		 je	 SHORT $LN18@SkyIslandD
  00156	83 ea 01	 sub	 edx, 1
  00159	75 16		 jne	 SHORT $LN20@SkyIslandD

; 478  : 						break;
; 479  : 					case 1:
; 480  : 						dy = rand() & 0x1f;

  0015b	e8 00 00 00 00	 call	 _rand
  00160	8b f8		 mov	 edi, eax
  00162	83 e7 1f	 and	 edi, 31			; 0000001fH

; 481  : 						break;

  00165	eb 0a		 jmp	 SHORT $LN20@SkyIslandD
$LN18@SkyIslandD:

; 476  : 					case 0:
; 477  : 						dx = rand() & 0x1f;

  00167	e8 00 00 00 00	 call	 _rand
  0016c	8b f0		 mov	 esi, eax
  0016e	83 e6 1f	 and	 esi, 31			; 0000001fH
$LN20@SkyIslandD:

; 482  : 					default:
; 483  : 						break;
; 484  : 					}
; 485  : 					iCloudX2 = -CloudWidth2 + dx + 40;

  00171	0f bf 0d 00 00
	00 00		 movsx	 ecx, WORD PTR ?CloudWidth2@@3FA ; CloudWidth2

; 486  : 					iCloudY2 = -CloudHeight2 + dy + 30;

  00178	0f bf 05 00 00
	00 00		 movsx	 eax, WORD PTR ?CloudHeight2@@3FA ; CloudHeight2
  0017f	2b f1		 sub	 esi, ecx
  00181	83 c6 28	 add	 esi, 40			; 00000028H
  00184	2b f8		 sub	 edi, eax
  00186	83 c7 1e	 add	 edi, 30			; 0000001eH
  00189	89 35 00 00 00
	00		 mov	 DWORD PTR ?iCloudX2@@3HA, esi ; iCloudX2
  0018f	89 3d 00 00 00
	00		 mov	 DWORD PTR ?iCloudY2@@3HA, edi ; iCloudY2
  00195	eb 06		 jmp	 SHORT $LN11@SkyIslandD
$LN28@SkyIslandD:

; 448  : #endif
; 449  : 			){
; 450  : 			if( (now = TimeGetTime()) > dwSlow2){

  00197	8b 3d 00 00 00
	00		 mov	 edi, DWORD PTR ?iCloudY2@@3HA ; iCloudY2
$LN11@SkyIslandD:

; 487  : 				}
; 488  : 			}
; 489  : 			int x, y;
; 490  : 			x = iCloudX2;
; 491  : 			y = iCloudY2;
; 492  : 			SetRect( &rc, 0, 0, CloudWidth2, CloudHeight2);

  0019d	0f bf 05 00 00
	00 00		 movsx	 eax, WORD PTR ?CloudHeight2@@3FA ; CloudHeight2
  001a4	50		 push	 eax
  001a5	0f bf 05 00 00
	00 00		 movsx	 eax, WORD PTR ?CloudWidth2@@3FA ; CloudWidth2
  001ac	50		 push	 eax
  001ad	6a 00		 push	 0
  001af	6a 00		 push	 0
  001b1	8d 45 ec	 lea	 eax, DWORD PTR _rc$[ebp]
  001b4	50		 push	 eax
  001b5	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__SetRect@20

; 493  : 			if( x < 0){

  001bb	85 f6		 test	 esi, esi
  001bd	79 09		 jns	 SHORT $LN29@SkyIslandD

; 494  : 				rc.left = -x;

  001bf	8b de		 mov	 ebx, esi
  001c1	f7 db		 neg	 ebx
  001c3	89 5d ec	 mov	 DWORD PTR _rc$[ebp], ebx
  001c6	eb 03		 jmp	 SHORT $LN21@SkyIslandD
$LN29@SkyIslandD:

; 493  : 			if( x < 0){

  001c8	8b 5d ec	 mov	 ebx, DWORD PTR _rc$[ebp]
$LN21@SkyIslandD:

; 495  : 				x = 0;
; 496  : 			}
; 497  : 			if( (x+CloudWidth2) >= DEF_APPSIZEX){

  001cb	0f bf 05 00 00
	00 00		 movsx	 eax, WORD PTR ?CloudWidth2@@3FA ; CloudWidth2
  001d2	33 d2		 xor	 edx, edx
  001d4	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?DEF_APPSIZEX@@3HA ; DEF_APPSIZEX
  001da	85 f6		 test	 esi, esi
  001dc	0f 49 d6	 cmovns	 edx, esi
  001df	03 c2		 add	 eax, edx
  001e1	89 55 e0	 mov	 DWORD PTR tv368[ebp], edx
  001e4	3b c1		 cmp	 eax, ecx
  001e6	7c 07		 jl	 SHORT $LN30@SkyIslandD

; 498  : 				rc.right = DEF_APPSIZEX - x;

  001e8	2b ca		 sub	 ecx, edx
  001ea	89 4d f4	 mov	 DWORD PTR _rc$[ebp+8], ecx
  001ed	eb 03		 jmp	 SHORT $LN22@SkyIslandD
$LN30@SkyIslandD:

; 495  : 				x = 0;
; 496  : 			}
; 497  : 			if( (x+CloudWidth2) >= DEF_APPSIZEX){

  001ef	8b 4d f4	 mov	 ecx, DWORD PTR _rc$[ebp+8]
$LN22@SkyIslandD:

; 499  : 			}
; 500  : 			if( y < 0){

  001f2	85 ff		 test	 edi, edi
  001f4	79 09		 jns	 SHORT $LN31@SkyIslandD

; 501  : 				rc.top = -y;

  001f6	8b f7		 mov	 esi, edi
  001f8	f7 de		 neg	 esi
  001fa	89 75 f0	 mov	 DWORD PTR _rc$[ebp+4], esi
  001fd	eb 03		 jmp	 SHORT $LN23@SkyIslandD
$LN31@SkyIslandD:

; 499  : 			}
; 500  : 			if( y < 0){

  001ff	8b 75 f0	 mov	 esi, DWORD PTR _rc$[ebp+4]
$LN23@SkyIslandD:

; 502  : 				y = 0;
; 503  : 			}
; 504  : 			if( (y+CloudHeight2) >= DEF_APPSIZEY){

  00202	0f bf 05 00 00
	00 00		 movsx	 eax, WORD PTR ?CloudHeight2@@3FA ; CloudHeight2
  00209	33 d2		 xor	 edx, edx
  0020b	85 ff		 test	 edi, edi
  0020d	0f 49 d7	 cmovns	 edx, edi
  00210	89 55 e8	 mov	 DWORD PTR tv367[ebp], edx
  00213	03 c2		 add	 eax, edx
  00215	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?DEF_APPSIZEY@@3HA ; DEF_APPSIZEY
  0021b	8b 7d e8	 mov	 edi, DWORD PTR tv367[ebp]
  0021e	3b c2		 cmp	 eax, edx
  00220	7c 07		 jl	 SHORT $LN32@SkyIslandD

; 505  : 				rc.bottom = DEF_APPSIZEY -y;

  00222	2b d7		 sub	 edx, edi
  00224	89 55 f8	 mov	 DWORD PTR _rc$[ebp+12], edx
  00227	eb 03		 jmp	 SHORT $LN24@SkyIslandD
$LN32@SkyIslandD:

; 502  : 				y = 0;
; 503  : 			}
; 504  : 			if( (y+CloudHeight2) >= DEF_APPSIZEY){

  00229	8b 55 f8	 mov	 edx, DWORD PTR _rc$[ebp+12]
$LN24@SkyIslandD:

; 506  : 			}
; 507  : 			if( (rc.bottom-rc.top)>0 && (rc.right-rc.left)>0){

  0022c	2b d6		 sub	 edx, esi
  0022e	85 d2		 test	 edx, edx
  00230	7e 24		 jle	 SHORT $LN34@SkyIslandD
  00232	2b cb		 sub	 ecx, ebx
  00234	85 c9		 test	 ecx, ecx
  00236	7e 1e		 jle	 SHORT $LN34@SkyIslandD

; 508  : 				lpDraw->lpBACKBUFFER->BltFast( x, y, lpsurCloud2, &rc, DDBLTFAST_WAIT|DDBLTFAST_SRCCOLORKEY);

  00238	a1 00 00 00 00	 mov	 eax, DWORD PTR ?lpDraw@@3PAUDIRECT_DRAW@@A ; lpDraw
  0023d	8d 55 ec	 lea	 edx, DWORD PTR _rc$[ebp]
  00240	6a 11		 push	 17			; 00000011H
  00242	52		 push	 edx
  00243	ff 35 00 00 00
	00		 push	 DWORD PTR ?lpsurCloud2@@3PAUIDirectDrawSurface@@A ; lpsurCloud2
  00249	8b 40 0c	 mov	 eax, DWORD PTR [eax+12]
  0024c	57		 push	 edi
  0024d	ff 75 e0	 push	 DWORD PTR tv368[ebp]
  00250	8b 08		 mov	 ecx, DWORD PTR [eax]
  00252	50		 push	 eax
  00253	ff 51 1c	 call	 DWORD PTR [ecx+28]
$LN34@SkyIslandD:
  00256	5f		 pop	 edi
  00257	5e		 pop	 esi
$LN33@SkyIslandD:
  00258	5b		 pop	 ebx
$LN25@SkyIslandD:

; 509  : #ifdef _READ16BITBMP
; 510  : 				if(g_bUseAlpha) lpDraw->lpBACKBUFFERSYS->BltFast( x, y, lpsurCloud2, &rc, DDBLTFAST_WAIT|DDBLTFAST_SRCCOLORKEY);
; 511  : #endif
; 512  : 			}
; 513  : 		}
; 514  : 	}
; 515  : }

  00259	8b 4d fc	 mov	 ecx, DWORD PTR __$ArrayPad$[ebp]
  0025c	33 cd		 xor	 ecx, ebp
  0025e	e8 00 00 00 00	 call	 @__security_check_cookie@4
  00263	8b e5		 mov	 esp, ebp
  00265	5d		 pop	 ebp
  00266	c3		 ret	 0
?SkyIslandDraw2@@YAXH@Z ENDP				; SkyIslandDraw2
_TEXT	ENDS
; Function compile flags: /Ogtp
; File \\VBOXSVR\_stoneage\repos\ssm-sacli\system\SkyIsland.cpp
;	COMDAT ?SkyIslandSetNo@@YAXH@Z
_TEXT	SEGMENT
_fl$ = 8						; size = 4
?SkyIslandSetNo@@YAXH@Z PROC				; SkyIslandSetNo, COMDAT

; 196  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 197  : 	sky_island_no_bak = sky_island_no;

  00003	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?sky_island_no@@3KA ; sky_island_no

; 198  : 	sky_island_no = 0;

  00009	33 c0		 xor	 eax, eax

; 199  : 
; 200  : #ifdef _MOON_FAIRYLAND				// (不可开) ROG ADD 月之仙境
; 201  : 	moonFlag =	FALSE;
; 202  : #endif
; 203  : #ifdef _NEW_CLOUD
; 204  : 	NCLOUD_Flag = FALSE;
; 205  : #endif
; 206  : 	switch( fl){

  0000b	8b 4d 08	 mov	 ecx, DWORD PTR _fl$[ebp]
  0000e	89 15 00 00 00
	00		 mov	 DWORD PTR ?sky_island_no_bak@@3KA, edx ; sky_island_no_bak
  00014	a3 00 00 00 00	 mov	 DWORD PTR ?sky_island_no@@3KA, eax ; sky_island_no
  00019	a3 00 00 00 00	 mov	 DWORD PTR ?moonFlag@@3HA, eax ; moonFlag
  0001e	a3 00 00 00 00	 mov	 DWORD PTR ?NCLOUD_Flag@@3HA, eax ; NCLOUD_Flag
  00023	81 f9 e1 77 00
	00		 cmp	 ecx, 30689		; 000077e1H
  00029	0f 8f 96 00 00
	00		 jg	 $LN21@SkyIslandS
  0002f	0f 84 89 00 00
	00		 je	 $LN9@SkyIslandS
  00035	81 f9 1b 1d 00
	00		 cmp	 ecx, 7451		; 00001d1bH
  0003b	7f 38		 jg	 SHORT $LN22@SkyIslandS
  0003d	0f 84 d3 00 00
	00		 je	 $LN14@SkyIslandS
  00043	83 f9 68	 cmp	 ecx, 104		; 00000068H
  00046	74 23		 je	 SHORT $LN16@SkyIslandS
  00048	81 f9 cd 15 00
	00		 cmp	 ecx, 5581		; 000015cdH
  0004e	74 11		 je	 SHORT $LN10@SkyIslandS
  00050	81 f9 1a 1d 00
	00		 cmp	 ecx, 7450		; 00001d1aH
  00056	0f 84 ba 00 00
	00		 je	 $LN14@SkyIslandS
  0005c	e9 bf 00 00 00	 jmp	 $LN2@SkyIslandS
$LN10@SkyIslandS:

; 226  : 	case 5581://金飞航空
; 227  : 		sky_island_no = (1<<16) | 40511;

  00061	b8 3f 9e 01 00	 mov	 eax, 106047		; 00019e3fH

; 228  : 		break;

  00066	e9 b0 00 00 00	 jmp	 $LN25@SkyIslandS
$LN16@SkyIslandS:

; 242  : #endif
; 243  : 
; 244  : #ifdef _LOST_FOREST_FOG
; 245  : 	case 7450:
; 246  : 	case 7451:
; 247  : 		sky_island_no = (1<<16);
; 248  : 		break;
; 249  : #endif
; 250  : 	// 神台
; 251  : 	case 104:
; 252  : 		sky_island_no = (2<<16) | 40511;

  0006b	b8 3f 9e 02 00	 mov	 eax, 171583		; 00029e3fH

; 253  : 		break;

  00070	e9 a6 00 00 00	 jmp	 $LN25@SkyIslandS
$LN22@SkyIslandS:

; 199  : 
; 200  : #ifdef _MOON_FAIRYLAND				// (不可开) ROG ADD 月之仙境
; 201  : 	moonFlag =	FALSE;
; 202  : #endif
; 203  : #ifdef _NEW_CLOUD
; 204  : 	NCLOUD_Flag = FALSE;
; 205  : #endif
; 206  : 	switch( fl){

  00075	81 e9 3f 20 00
	00		 sub	 ecx, 8255		; 0000203fH
  0007b	74 30		 je	 SHORT $LN11@SkyIslandS
  0007d	83 e9 01	 sub	 ecx, 1
  00080	74 1a		 je	 SHORT $LN12@SkyIslandS
  00082	83 e9 01	 sub	 ecx, 1
  00085	0f 85 95 00 00
	00		 jne	 $LN2@SkyIslandS

; 238  : 	case 8257:
; 239  : 		sky_island_no = (3<<16) | 40512;

  0008b	b8 40 9e 03 00	 mov	 eax, 237120		; 00039e40H

; 240  : 		moonFlag =	TRUE;

  00090	c7 05 00 00 00
	00 01 00 00 00	 mov	 DWORD PTR ?moonFlag@@3HA, 1 ; moonFlag

; 241  : 		break;

  0009a	eb 7f		 jmp	 SHORT $LN25@SkyIslandS
$LN12@SkyIslandS:

; 234  : 	case 8256:
; 235  : 		sky_island_no = (2<<16) | 40512;

  0009c	b8 40 9e 02 00	 mov	 eax, 171584		; 00029e40H

; 236  : 		moonFlag =	TRUE;

  000a1	c7 05 00 00 00
	00 01 00 00 00	 mov	 DWORD PTR ?moonFlag@@3HA, 1 ; moonFlag

; 237  : 		break;

  000ab	eb 6e		 jmp	 SHORT $LN25@SkyIslandS
$LN11@SkyIslandS:

; 229  : #ifdef _MOON_FAIRYLAND				// (不可开) ROG ADD 月之仙境
; 230  : 	case 8255:
; 231  : 		sky_island_no = (1<<16) | 40512;

  000ad	b8 40 9e 01 00	 mov	 eax, 106048		; 00019e40H

; 232  : 		moonFlag =	TRUE;

  000b2	c7 05 00 00 00
	00 01 00 00 00	 mov	 DWORD PTR ?moonFlag@@3HA, 1 ; moonFlag

; 233  : 		break;

  000bc	eb 5d		 jmp	 SHORT $LN25@SkyIslandS
$LN9@SkyIslandS:

; 223  : 	case 30689:
; 224  : 		sky_island_no = (6<<16) | 40510;

  000be	b8 3e 9e 06 00	 mov	 eax, 433726		; 00069e3eH

; 225  : 		break;

  000c3	eb 56		 jmp	 SHORT $LN25@SkyIslandS
$LN21@SkyIslandS:

; 199  : 
; 200  : #ifdef _MOON_FAIRYLAND				// (不可开) ROG ADD 月之仙境
; 201  : 	moonFlag =	FALSE;
; 202  : #endif
; 203  : #ifdef _NEW_CLOUD
; 204  : 	NCLOUD_Flag = FALSE;
; 205  : #endif
; 206  : 	switch( fl){

  000c5	81 f9 48 ee 00
	00		 cmp	 ecx, 61000		; 0000ee48H
  000cb	7f 37		 jg	 SHORT $LN23@SkyIslandS
  000cd	74 3d		 je	 SHORT $LN17@SkyIslandS
  000cf	81 c1 1d 88 ff
	ff		 add	 ecx, -30691		; ffff881dH
  000d5	83 f9 04	 cmp	 ecx, 4
  000d8	77 46		 ja	 SHORT $LN2@SkyIslandS
  000da	ff 24 8d 00 00
	00 00		 jmp	 DWORD PTR $LN24@SkyIslandS[ecx*4]
$LN4@SkyIslandS:

; 207  : //避免重复的loadmap动作
; 208  : 	case 30691:
; 209  : 		sky_island_no = (1<<16) | 40510;

  000e1	b8 3e 9e 01 00	 mov	 eax, 106046		; 00019e3eH

; 210  : 		break;

  000e6	eb 33		 jmp	 SHORT $LN25@SkyIslandS
$LN5@SkyIslandS:

; 211  : 	case 30692:
; 212  : 		sky_island_no = (2<<16) | 40510;

  000e8	b8 3e 9e 02 00	 mov	 eax, 171582		; 00029e3eH

; 213  : 		break;

  000ed	eb 2c		 jmp	 SHORT $LN25@SkyIslandS
$LN6@SkyIslandS:

; 214  : 	case 30693:
; 215  : 		sky_island_no = (3<<16) | 40510;

  000ef	b8 3e 9e 03 00	 mov	 eax, 237118		; 00039e3eH

; 216  : 		break;

  000f4	eb 25		 jmp	 SHORT $LN25@SkyIslandS
$LN7@SkyIslandS:

; 217  : 	case 30694:
; 218  : 		sky_island_no = (4<<16) | 40510;

  000f6	b8 3e 9e 04 00	 mov	 eax, 302654		; 00049e3eH

; 219  : 		break;

  000fb	eb 1e		 jmp	 SHORT $LN25@SkyIslandS
$LN8@SkyIslandS:

; 220  : 	case 30695:
; 221  : 		sky_island_no = (5<<16) | 40510;

  000fd	b8 3e 9e 05 00	 mov	 eax, 368190		; 00059e3eH

; 222  : 		break;

  00102	eb 17		 jmp	 SHORT $LN25@SkyIslandS
$LN23@SkyIslandS:

; 199  : 
; 200  : #ifdef _MOON_FAIRYLAND				// (不可开) ROG ADD 月之仙境
; 201  : 	moonFlag =	FALSE;
; 202  : #endif
; 203  : #ifdef _NEW_CLOUD
; 204  : 	NCLOUD_Flag = FALSE;
; 205  : #endif
; 206  : 	switch( fl){

  00104	81 f9 ac ee 00
	00		 cmp	 ecx, 61100		; 0000eeacH
  0010a	75 14		 jne	 SHORT $LN2@SkyIslandS
$LN17@SkyIslandS:

; 254  : #ifdef _NEW_CLOUD
; 255  : 	case 61000:
; 256  : 	case 61100:
; 257  : 		sky_island_no = (1<<16);
; 258  : 		NCLOUD_Flag = TRUE;

  0010c	c7 05 00 00 00
	00 01 00 00 00	 mov	 DWORD PTR ?NCLOUD_Flag@@3HA, 1 ; NCLOUD_Flag
$LN14@SkyIslandS:

; 259  : 		break;
; 260  : #endif
; 261  : 	}
; 262  : 	if( sky_island_no_bak != sky_island_no){

  00116	b8 00 00 01 00	 mov	 eax, 65536		; 00010000H
$LN25@SkyIslandS:
  0011b	a3 00 00 00 00	 mov	 DWORD PTR ?sky_island_no@@3KA, eax ; sky_island_no
$LN2@SkyIslandS:
  00120	3b d0		 cmp	 edx, eax
  00122	0f 84 81 00 00
	00		 je	 $LN19@SkyIslandS

; 263  : 		SkyIslandLoadBmp();

  00128	53		 push	 ebx
  00129	56		 push	 esi
  0012a	57		 push	 edi
  0012b	e8 00 00 00 00	 call	 ?SkyIslandLoadBmp@@YAXXZ ; SkyIslandLoadBmp

; 264  : 		int x,y;
; 265  : 		
; 266  : 		x = ((nowGx + nowGy) * (SURFACE_WIDTH >> 1));

  00130	8b 3d 00 00 00
	00		 mov	 edi, DWORD PTR ?nowGy@@3HA ; nowGy
  00136	8b 35 00 00 00
	00		 mov	 esi, DWORD PTR ?nowGx@@3HA ; nowGx

; 267  : 		y = ((nowFloorGySize + nowGy - nowGx) * (SURFACE_HEIGHT >> 1));
; 268  : 		g_rc.left = ((LandWidth-DEF_APPSIZEX)*x/fMapWidth);

  0013c	0f bf 05 00 00
	00 00		 movsx	 eax, WORD PTR ?LandWidth@@3FA ; LandWidth
  00143	2b 05 00 00 00
	00		 sub	 eax, DWORD PTR ?DEF_APPSIZEX@@3HA ; DEF_APPSIZEX
  00149	8d 0c 37	 lea	 ecx, DWORD PTR [edi+esi]
  0014c	0f af c1	 imul	 eax, ecx

; 269  : 		g_rc.top = ((LandHeight-DEF_APPSIZEY)*y/fMapHeight);

  0014f	0f bf 0d 00 00
	00 00		 movsx	 ecx, WORD PTR ?LandHeight@@3FA ; LandHeight
  00156	2b 0d 00 00 00
	00		 sub	 ecx, DWORD PTR ?DEF_APPSIZEY@@3HA ; DEF_APPSIZEY
  0015c	c1 e0 05	 shl	 eax, 5
  0015f	99		 cdq
  00160	f7 3d 00 00 00
	00		 idiv	 DWORD PTR ?fMapWidth@@3HA ; fMapWidth
  00166	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?nowFloorGySize@@3HA ; nowFloorGySize
  0016c	2b d6		 sub	 edx, esi
  0016e	8b d8		 mov	 ebx, eax
  00170	03 d7		 add	 edx, edi
  00172	89 1d 00 00 00
	00		 mov	 DWORD PTR ?g_rc@@3UtagRECT@@A, ebx
  00178	0f af d1	 imul	 edx, ecx
  0017b	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?DEF_APPSIZEX@@3HA ; DEF_APPSIZEX
  00181	03 cb		 add	 ecx, ebx

; 270  : 		g_rc.right = g_rc.left + DEF_APPSIZEX;
; 271  : 		g_rc.bottom = g_rc.top + DEF_APPSIZEY;

  00183	5f		 pop	 edi
  00184	5e		 pop	 esi
  00185	89 0d 08 00 00
	00		 mov	 DWORD PTR ?g_rc@@3UtagRECT@@A+8, ecx
  0018b	5b		 pop	 ebx
  0018c	8d 04 52	 lea	 eax, DWORD PTR [edx+edx*2]
  0018f	c1 e0 03	 shl	 eax, 3
  00192	99		 cdq
  00193	f7 3d 00 00 00
	00		 idiv	 DWORD PTR ?fMapHeight@@3HA ; fMapHeight
  00199	a3 04 00 00 00	 mov	 DWORD PTR ?g_rc@@3UtagRECT@@A+4, eax
  0019e	03 05 00 00 00
	00		 add	 eax, DWORD PTR ?DEF_APPSIZEY@@3HA ; DEF_APPSIZEY
  001a4	a3 0c 00 00 00	 mov	 DWORD PTR ?g_rc@@3UtagRECT@@A+12, eax
$LN19@SkyIslandS:

; 272  : 	}
; 273  : }

  001a9	5d		 pop	 ebp
  001aa	c3		 ret	 0
  001ab	90		 npad	 1
$LN24@SkyIslandS:
  001ac	00 00 00 00	 DD	 $LN4@SkyIslandS
  001b0	00 00 00 00	 DD	 $LN5@SkyIslandS
  001b4	00 00 00 00	 DD	 $LN6@SkyIslandS
  001b8	00 00 00 00	 DD	 $LN7@SkyIslandS
  001bc	00 00 00 00	 DD	 $LN8@SkyIslandS
?SkyIslandSetNo@@YAXH@Z ENDP				; SkyIslandSetNo
_TEXT	ENDS
; Function compile flags: /Ogtp
; File \\VBOXSVR\_stoneage\repos\ssm-sacli\system\SkyIsland.cpp
;	COMDAT ?SkyIslandLoadBmp@@YAXXZ
_TEXT	SEGMENT
_no$1 = -24						; size = 4
_no$2 = -20						; size = 4
_w$3 = -16						; size = 2
_h$4 = -12						; size = 2
_w$5 = -8						; size = 2
_h$6 = -4						; size = 2
?SkyIslandLoadBmp@@YAXXZ PROC				; SkyIslandLoadBmp, COMDAT

; 132  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 133  : 	if( sky_island_no){

  00003	a1 00 00 00 00	 mov	 eax, DWORD PTR ?sky_island_no@@3KA ; sky_island_no
  00008	83 ec 18	 sub	 esp, 24			; 00000018H
  0000b	85 c0		 test	 eax, eax
  0000d	0f 84 74 02 00
	00		 je	 $LN14@SkyIslandL

; 134  : 		short w, h;
; 135  : 		DWORD no;
; 136  : 		realGetNo( sky_island_no & 0xffff, &no );

  00013	56		 push	 esi
  00014	57		 push	 edi
  00015	8d 4d ec	 lea	 ecx, DWORD PTR _no$2[ebp]
  00018	0f b7 c0	 movzx	 eax, ax
  0001b	51		 push	 ecx
  0001c	50		 push	 eax
  0001d	e8 00 00 00 00	 call	 ?realGetNo@@YAHKPAK@Z	; realGetNo

; 137  : 		realGetWH( no, &w, &h);

  00022	8d 45 f4	 lea	 eax, DWORD PTR _h$4[ebp]
  00025	50		 push	 eax
  00026	8d 45 f0	 lea	 eax, DWORD PTR _w$3[ebp]
  00029	50		 push	 eax
  0002a	ff 75 ec	 push	 DWORD PTR _no$2[ebp]
  0002d	e8 00 00 00 00	 call	 ?realGetWH@@YAHKPAF0@Z	; realGetWH

; 138  : 		if( w != LandWidth || h != LandHeight){

  00032	8b 75 f0	 mov	 esi, DWORD PTR _w$3[ebp]
  00035	83 c4 14	 add	 esp, 20			; 00000014H
  00038	8b 55 f4	 mov	 edx, DWORD PTR _h$4[ebp]
  0003b	66 3b 35 00 00
	00 00		 cmp	 si, WORD PTR ?LandWidth@@3FA ; LandWidth
  00042	75 11		 jne	 SHORT $LN4@SkyIslandL
  00044	66 3b 15 00 00
	00 00		 cmp	 dx, WORD PTR ?LandHeight@@3FA ; LandHeight
  0004b	75 08		 jne	 SHORT $LN4@SkyIslandL
  0004d	8b 3d 00 00 00
	00		 mov	 edi, DWORD PTR ?lpsurLand@@3PAUIDirectDrawSurface@@A ; lpsurLand
  00053	eb 72		 jmp	 SHORT $LN3@SkyIslandL
$LN4@SkyIslandL:

; 139  : 			fMapWidth = ((nowFloorGxSize + nowFloorGySize) * SURFACE_WIDTH) >> 1; // fMapWidth = (nowFloorGxSize+nowFloorGySize)*SURFACE_WIDTH/2;

  00055	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?nowFloorGxSize@@3HA ; nowFloorGxSize
  0005b	03 0d 00 00 00
	00		 add	 ecx, DWORD PTR ?nowFloorGySize@@3HA ; nowFloorGySize
  00061	8b c1		 mov	 eax, ecx

; 140  : 			fMapHeight = ((nowFloorGxSize + nowFloorGySize) * SURFACE_HEIGHT) >> 1; //fMapWidth = (nowFloorGxSize+nowFloorGySize)*SURFACE_WIDTH/2;
; 141  : 			LandWidth = w;

  00063	66 89 35 00 00
	00 00		 mov	 WORD PTR ?LandWidth@@3FA, si ; LandWidth
  0006a	c1 e0 06	 shl	 eax, 6
  0006d	d1 f8		 sar	 eax, 1
  0006f	a3 00 00 00 00	 mov	 DWORD PTR ?fMapWidth@@3HA, eax ; fMapWidth
  00074	8d 04 49	 lea	 eax, DWORD PTR [ecx+ecx*2]

; 142  : 			LandHeight = h;
; 143  : 			if( lpsurLand){

  00077	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?lpsurLand@@3PAUIDirectDrawSurface@@A ; lpsurLand
  0007d	c1 e0 04	 shl	 eax, 4
  00080	d1 f8		 sar	 eax, 1
  00082	a3 00 00 00 00	 mov	 DWORD PTR ?fMapHeight@@3HA, eax ; fMapHeight
  00087	66 89 15 00 00
	00 00		 mov	 WORD PTR ?LandHeight@@3FA, dx ; LandHeight
  0008e	85 c9		 test	 ecx, ecx
  00090	74 16		 je	 SHORT $LN5@SkyIslandL

; 144  : 				lpsurLand->Release();

  00092	8b 01		 mov	 eax, DWORD PTR [ecx]
  00094	51		 push	 ecx
  00095	ff 50 08	 call	 DWORD PTR [eax+8]

; 145  : 				lpsurLand = NULL;

  00098	8b 75 f0	 mov	 esi, DWORD PTR _w$3[ebp]
  0009b	8b 55 f4	 mov	 edx, DWORD PTR _h$4[ebp]
  0009e	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?lpsurLand@@3PAUIDirectDrawSurface@@A, 0 ; lpsurLand
$LN5@SkyIslandL:

; 146  : 			}
; 147  : 			lpsurLand = CreateSurface( w, h, 0, DDSCAPS_SYSTEMMEMORY);

  000a8	68 00 08 00 00	 push	 2048			; 00000800H
  000ad	6a 00		 push	 0
  000af	52		 push	 edx
  000b0	56		 push	 esi
  000b1	e8 00 00 00 00	 call	 ?CreateSurface@@YAPAUIDirectDrawSurface@@FFKI@Z ; CreateSurface
  000b6	8b 75 f0	 mov	 esi, DWORD PTR _w$3[ebp]
  000b9	8b f8		 mov	 edi, eax
  000bb	8b 55 f4	 mov	 edx, DWORD PTR _h$4[ebp]
  000be	83 c4 10	 add	 esp, 16			; 00000010H
  000c1	89 3d 00 00 00
	00		 mov	 DWORD PTR ?lpsurLand@@3PAUIDirectDrawSurface@@A, edi ; lpsurLand
$LN3@SkyIslandL:

; 148  : 		}
; 149  : 		if( lpsurLand){

  000c7	85 ff		 test	 edi, edi
  000c9	0f 84 b6 01 00
	00		 je	 $LN17@SkyIslandL

; 150  : 			LoadBmpToSurface( no, lpsurLand, w, h);

  000cf	0f bf ca	 movsx	 ecx, dx
  000d2	51		 push	 ecx
  000d3	0f bf c6	 movsx	 eax, si
  000d6	50		 push	 eax
  000d7	57		 push	 edi
  000d8	ff 75 ec	 push	 DWORD PTR _no$2[ebp]
  000db	e8 00 00 00 00	 call	 ?LoadBmpToSurface@@YAXHPAUIDirectDrawSurface@@HH@Z ; LoadBmpToSurface
  000e0	83 c4 10	 add	 esp, 16			; 00000010H

; 151  : 			if( !lpsurCloud1){

  000e3	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?lpsurCloud1@@3PAUIDirectDrawSurface@@A, 0 ; lpsurCloud1
  000ea	0f 85 c4 00 00
	00		 jne	 $LN10@SkyIslandL

; 152  : #ifdef _NEW_CLOUD
; 153  : 				if( NCLOUD_Flag == TRUE )

  000f0	83 3d 00 00 00
	00 01		 cmp	 DWORD PTR ?NCLOUD_Flag@@3HA, 1 ; NCLOUD_Flag
  000f7	75 18		 jne	 SHORT $LN8@SkyIslandL

; 154  : 					realGetNo( 29077+(rand()%2), &no);

  000f9	e8 00 00 00 00	 call	 _rand
  000fe	25 01 00 00 80	 and	 eax, -2147483647	; 80000001H
  00103	79 05		 jns	 SHORT $LN19@SkyIslandL
  00105	48		 dec	 eax
  00106	83 c8 fe	 or	 eax, -2			; fffffffeH
  00109	40		 inc	 eax
$LN19@SkyIslandL:
  0010a	05 95 71 00 00	 add	 eax, 29077		; 00007195H
  0010f	eb 0d		 jmp	 SHORT $LN9@SkyIslandL
$LN8@SkyIslandL:

; 155  : 				else
; 156  : 					realGetNo( 40500+(rand()&0x3), &no);

  00111	e8 00 00 00 00	 call	 _rand
  00116	83 e0 03	 and	 eax, 3
  00119	05 34 9e 00 00	 add	 eax, 40500		; 00009e34H
$LN9@SkyIslandL:

; 157  : #else
; 158  : 				realGetNo( 40500+(rand()&0x3), &no);
; 159  : #endif
; 160  : 				realGetWH( no, &w, &h);

  0011e	8d 4d ec	 lea	 ecx, DWORD PTR _no$2[ebp]
  00121	51		 push	 ecx
  00122	50		 push	 eax
  00123	e8 00 00 00 00	 call	 ?realGetNo@@YAHKPAK@Z	; realGetNo
  00128	8d 45 f4	 lea	 eax, DWORD PTR _h$4[ebp]
  0012b	50		 push	 eax
  0012c	8d 45 f0	 lea	 eax, DWORD PTR _w$3[ebp]
  0012f	50		 push	 eax
  00130	ff 75 ec	 push	 DWORD PTR _no$2[ebp]
  00133	e8 00 00 00 00	 call	 ?realGetWH@@YAHKPAF0@Z	; realGetWH

; 161  : 				CloudWidth1 = w;

  00138	0f b7 45 f0	 movzx	 eax, WORD PTR _w$3[ebp]
  0013c	66 a3 00 00 00
	00		 mov	 WORD PTR ?CloudWidth1@@3FA, ax ; CloudWidth1

; 162  : 				CloudHeight1 = h;

  00142	0f b7 45 f4	 movzx	 eax, WORD PTR _h$4[ebp]
  00146	66 a3 00 00 00
	00		 mov	 WORD PTR ?CloudHeight1@@3FA, ax ; CloudHeight1

; 163  : 				iCloudX1 = rand() % w;

  0014c	e8 00 00 00 00	 call	 _rand
  00151	0f bf 4d f0	 movsx	 ecx, WORD PTR _w$3[ebp]
  00155	99		 cdq
  00156	f7 f9		 idiv	 ecx
  00158	89 15 00 00 00
	00		 mov	 DWORD PTR ?iCloudX1@@3HA, edx ; iCloudX1

; 164  : 				iCloudY1 = rand() % h;

  0015e	e8 00 00 00 00	 call	 _rand
  00163	0f bf 4d f4	 movsx	 ecx, WORD PTR _h$4[ebp]
  00167	99		 cdq
  00168	f7 f9		 idiv	 ecx

; 165  : 
; 166  : 				if( lpsurCloud1 = CreateSurface(lpDraw->xSize, lpDraw->ySize, 0, DDSCAPS_SYSTEMMEMORY) ){

  0016a	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?lpDraw@@3PAUDIRECT_DRAW@@A ; lpDraw
  00170	68 00 08 00 00	 push	 2048			; 00000800H
  00175	89 15 00 00 00
	00		 mov	 DWORD PTR ?iCloudY1@@3HA, edx ; iCloudY1
  0017b	6a 00		 push	 0
  0017d	0f b7 81 88 00
	00 00		 movzx	 eax, WORD PTR [ecx+136]
  00184	50		 push	 eax
  00185	0f b7 81 84 00
	00 00		 movzx	 eax, WORD PTR [ecx+132]
  0018c	50		 push	 eax
  0018d	e8 00 00 00 00	 call	 ?CreateSurface@@YAPAUIDirectDrawSurface@@FFKI@Z ; CreateSurface
  00192	83 c4 24	 add	 esp, 36			; 00000024H
  00195	a3 00 00 00 00	 mov	 DWORD PTR ?lpsurCloud1@@3PAUIDirectDrawSurface@@A, eax ; lpsurCloud1
  0019a	85 c0		 test	 eax, eax
  0019c	74 16		 je	 SHORT $LN10@SkyIslandL

; 167  : 					LoadBmpToSurface( no, lpsurCloud1, w, h);

  0019e	0f bf 4d f4	 movsx	 ecx, WORD PTR _h$4[ebp]
  001a2	51		 push	 ecx
  001a3	0f bf 4d f0	 movsx	 ecx, WORD PTR _w$3[ebp]
  001a7	51		 push	 ecx
  001a8	50		 push	 eax
  001a9	ff 75 ec	 push	 DWORD PTR _no$2[ebp]
  001ac	e8 00 00 00 00	 call	 ?LoadBmpToSurface@@YAXHPAUIDirectDrawSurface@@HH@Z ; LoadBmpToSurface
  001b1	83 c4 10	 add	 esp, 16			; 00000010H
$LN10@SkyIslandL:

; 168  : 				}
; 169  : 			}
; 170  : 			if( !lpsurCloud2){

  001b4	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?lpsurCloud2@@3PAUIDirectDrawSurface@@A, 0 ; lpsurCloud2
  001bb	0f 85 c4 00 00
	00		 jne	 $LN17@SkyIslandL

; 171  : 				short w, h;
; 172  : 				DWORD no;
; 173  : #ifdef _NEW_CLOUD
; 174  : 				if( NCLOUD_Flag == TRUE )

  001c1	83 3d 00 00 00
	00 01		 cmp	 DWORD PTR ?NCLOUD_Flag@@3HA, 1 ; NCLOUD_Flag
  001c8	75 18		 jne	 SHORT $LN12@SkyIslandL

; 175  : 					realGetNo( 29077+(rand()%2), &no);

  001ca	e8 00 00 00 00	 call	 _rand
  001cf	25 01 00 00 80	 and	 eax, -2147483647	; 80000001H
  001d4	79 05		 jns	 SHORT $LN20@SkyIslandL
  001d6	48		 dec	 eax
  001d7	83 c8 fe	 or	 eax, -2			; fffffffeH
  001da	40		 inc	 eax
$LN20@SkyIslandL:
  001db	05 95 71 00 00	 add	 eax, 29077		; 00007195H
  001e0	eb 0d		 jmp	 SHORT $LN13@SkyIslandL
$LN12@SkyIslandL:

; 176  : 				else
; 177  : 					realGetNo( 40500+(rand()&0x3), &no);

  001e2	e8 00 00 00 00	 call	 _rand
  001e7	83 e0 03	 and	 eax, 3
  001ea	05 34 9e 00 00	 add	 eax, 40500		; 00009e34H
$LN13@SkyIslandL:

; 178  : #else
; 179  : 				realGetNo( 40500+(rand()&0x3), &no);
; 180  : #endif
; 181  : 				realGetWH( no, &w, &h);

  001ef	8d 4d e8	 lea	 ecx, DWORD PTR _no$1[ebp]
  001f2	51		 push	 ecx
  001f3	50		 push	 eax
  001f4	e8 00 00 00 00	 call	 ?realGetNo@@YAHKPAK@Z	; realGetNo
  001f9	8d 45 fc	 lea	 eax, DWORD PTR _h$6[ebp]
  001fc	50		 push	 eax
  001fd	8d 45 f8	 lea	 eax, DWORD PTR _w$5[ebp]
  00200	50		 push	 eax
  00201	ff 75 e8	 push	 DWORD PTR _no$1[ebp]
  00204	e8 00 00 00 00	 call	 ?realGetWH@@YAHKPAF0@Z	; realGetWH

; 182  : 				CloudWidth2 = w;

  00209	0f b7 45 f8	 movzx	 eax, WORD PTR _w$5[ebp]
  0020d	66 a3 00 00 00
	00		 mov	 WORD PTR ?CloudWidth2@@3FA, ax ; CloudWidth2

; 183  : 				CloudHeight2 = h;

  00213	0f b7 45 fc	 movzx	 eax, WORD PTR _h$6[ebp]
  00217	66 a3 00 00 00
	00		 mov	 WORD PTR ?CloudHeight2@@3FA, ax ; CloudHeight2

; 184  : 				iCloudX2 = rand() % w;

  0021d	e8 00 00 00 00	 call	 _rand
  00222	0f bf 4d f8	 movsx	 ecx, WORD PTR _w$5[ebp]
  00226	99		 cdq
  00227	f7 f9		 idiv	 ecx
  00229	89 15 00 00 00
	00		 mov	 DWORD PTR ?iCloudX2@@3HA, edx ; iCloudX2

; 185  : 				iCloudY2 = rand() % h;

  0022f	e8 00 00 00 00	 call	 _rand
  00234	0f bf 4d fc	 movsx	 ecx, WORD PTR _h$6[ebp]
  00238	99		 cdq
  00239	f7 f9		 idiv	 ecx

; 186  : 				if( lpsurCloud2 = CreateSurface(lpDraw->xSize, lpDraw->ySize, 0, DDSCAPS_SYSTEMMEMORY) ){

  0023b	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?lpDraw@@3PAUDIRECT_DRAW@@A ; lpDraw
  00241	68 00 08 00 00	 push	 2048			; 00000800H
  00246	89 15 00 00 00
	00		 mov	 DWORD PTR ?iCloudY2@@3HA, edx ; iCloudY2
  0024c	6a 00		 push	 0
  0024e	0f b7 81 88 00
	00 00		 movzx	 eax, WORD PTR [ecx+136]
  00255	50		 push	 eax
  00256	0f b7 81 84 00
	00 00		 movzx	 eax, WORD PTR [ecx+132]
  0025d	50		 push	 eax
  0025e	e8 00 00 00 00	 call	 ?CreateSurface@@YAPAUIDirectDrawSurface@@FFKI@Z ; CreateSurface
  00263	83 c4 24	 add	 esp, 36			; 00000024H
  00266	a3 00 00 00 00	 mov	 DWORD PTR ?lpsurCloud2@@3PAUIDirectDrawSurface@@A, eax ; lpsurCloud2
  0026b	85 c0		 test	 eax, eax
  0026d	74 16		 je	 SHORT $LN17@SkyIslandL

; 187  : 					LoadBmpToSurface( no, lpsurCloud2, w, h);

  0026f	0f bf 4d fc	 movsx	 ecx, WORD PTR _h$6[ebp]
  00273	51		 push	 ecx
  00274	0f bf 4d f8	 movsx	 ecx, WORD PTR _w$5[ebp]
  00278	51		 push	 ecx
  00279	50		 push	 eax
  0027a	ff 75 e8	 push	 DWORD PTR _no$1[ebp]
  0027d	e8 00 00 00 00	 call	 ?LoadBmpToSurface@@YAXHPAUIDirectDrawSurface@@HH@Z ; LoadBmpToSurface
  00282	83 c4 10	 add	 esp, 16			; 00000010H
$LN17@SkyIslandL:
  00285	5f		 pop	 edi
  00286	5e		 pop	 esi
$LN14@SkyIslandL:

; 188  : 				}
; 189  : 			}			
; 190  : 		}
; 191  : 
; 192  : 	}
; 193  : }

  00287	8b e5		 mov	 esp, ebp
  00289	5d		 pop	 ebp
  0028a	c3		 ret	 0
?SkyIslandLoadBmp@@YAXXZ ENDP				; SkyIslandLoadBmp
_TEXT	ENDS
; Function compile flags: /Ogtp
; File \\VBOXSVR\_stoneage\repos\ssm-sacli\system\SkyIsland.cpp
;	COMDAT ?SkyIslandRelease@@YAXXZ
_TEXT	SEGMENT
?SkyIslandRelease@@YAXXZ PROC				; SkyIslandRelease, COMDAT

; 114  : 	LandWidth = 0;
; 115  : 	CloudWidth1 = 0;
; 116  : 	CloudWidth2 = 0;
; 117  : 	if( lpsurLand){

  00000	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?lpsurLand@@3PAUIDirectDrawSurface@@A ; lpsurLand
  00006	33 c0		 xor	 eax, eax
  00008	66 a3 00 00 00
	00		 mov	 WORD PTR ?LandWidth@@3FA, ax ; LandWidth
  0000e	66 a3 00 00 00
	00		 mov	 WORD PTR ?CloudWidth1@@3FA, ax ; CloudWidth1
  00014	66 a3 00 00 00
	00		 mov	 WORD PTR ?CloudWidth2@@3FA, ax ; CloudWidth2
  0001a	85 c9		 test	 ecx, ecx
  0001c	74 10		 je	 SHORT $LN2@SkyIslandR

; 118  : 		lpsurLand->Release();

  0001e	8b 01		 mov	 eax, DWORD PTR [ecx]
  00020	51		 push	 ecx
  00021	ff 50 08	 call	 DWORD PTR [eax+8]

; 119  : 		lpsurLand = NULL;

  00024	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?lpsurLand@@3PAUIDirectDrawSurface@@A, 0 ; lpsurLand
$LN2@SkyIslandR:

; 120  : 	}
; 121  : 	if( lpsurCloud1){

  0002e	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?lpsurCloud1@@3PAUIDirectDrawSurface@@A ; lpsurCloud1
  00034	85 c9		 test	 ecx, ecx
  00036	74 10		 je	 SHORT $LN3@SkyIslandR

; 122  : 		lpsurCloud1->Release();

  00038	8b 01		 mov	 eax, DWORD PTR [ecx]
  0003a	51		 push	 ecx
  0003b	ff 50 08	 call	 DWORD PTR [eax+8]

; 123  : 		lpsurCloud1 = NULL;

  0003e	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?lpsurCloud1@@3PAUIDirectDrawSurface@@A, 0 ; lpsurCloud1
$LN3@SkyIslandR:

; 124  : 	}
; 125  : 	if( lpsurCloud2){

  00048	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?lpsurCloud2@@3PAUIDirectDrawSurface@@A ; lpsurCloud2
  0004e	85 c9		 test	 ecx, ecx
  00050	74 10		 je	 SHORT $LN4@SkyIslandR

; 126  : 		lpsurCloud2->Release();

  00052	8b 01		 mov	 eax, DWORD PTR [ecx]
  00054	51		 push	 ecx
  00055	ff 50 08	 call	 DWORD PTR [eax+8]

; 127  : 		lpsurCloud2 = NULL;

  00058	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?lpsurCloud2@@3PAUIDirectDrawSurface@@A, 0 ; lpsurCloud2
$LN4@SkyIslandR:

; 128  : 	}
; 129  : }

  00062	c3		 ret	 0
?SkyIslandRelease@@YAXXZ ENDP				; SkyIslandRelease
_TEXT	ENDS
; Function compile flags: /Ogtp
; File \\VBOXSVR\_stoneage\repos\ssm-sacli\system\SkyIsland.cpp
;	COMDAT ?SkyIslandInit@@YAXXZ
_TEXT	SEGMENT
?SkyIslandInit@@YAXXZ PROC				; SkyIslandInit, COMDAT

; 101  : 	sky_island_no = 0;
; 102  : 	sky_island_no_bak = 0;
; 103  : 	LandWidth = 0;

  00000	33 c0		 xor	 eax, eax
  00002	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?sky_island_no@@3KA, 0 ; sky_island_no
  0000c	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?sky_island_no_bak@@3KA, 0 ; sky_island_no_bak
  00016	66 a3 00 00 00
	00		 mov	 WORD PTR ?LandWidth@@3FA, ax ; LandWidth

; 104  : 	LandHeight = 0;

  0001c	66 a3 00 00 00
	00		 mov	 WORD PTR ?LandHeight@@3FA, ax ; LandHeight

; 105  : 	CloudWidth1 = CloudHeight1 = 0;

  00022	66 a3 00 00 00
	00		 mov	 WORD PTR ?CloudHeight1@@3FA, ax ; CloudHeight1
  00028	66 a3 00 00 00
	00		 mov	 WORD PTR ?CloudWidth1@@3FA, ax ; CloudWidth1

; 106  : 	CloudWidth2 = CloudHeight2 = 0;

  0002e	66 a3 00 00 00
	00		 mov	 WORD PTR ?CloudHeight2@@3FA, ax ; CloudHeight2
  00034	66 a3 00 00 00
	00		 mov	 WORD PTR ?CloudWidth2@@3FA, ax ; CloudWidth2

; 107  : 	iCloudX1 = iCloudY1 = 0;

  0003a	a3 00 00 00 00	 mov	 DWORD PTR ?iCloudY1@@3HA, eax ; iCloudY1
  0003f	a3 00 00 00 00	 mov	 DWORD PTR ?iCloudX1@@3HA, eax ; iCloudX1

; 108  : 	iCloudX2 = iCloudY2 = 0;

  00044	a3 00 00 00 00	 mov	 DWORD PTR ?iCloudY2@@3HA, eax ; iCloudY2
  00049	a3 00 00 00 00	 mov	 DWORD PTR ?iCloudX2@@3HA, eax ; iCloudX2

; 109  : 	iCloudDX = iCloudDY = 0;

  0004e	a3 00 00 00 00	 mov	 DWORD PTR ?iCloudDY@@3HA, eax ; iCloudDY
  00053	a3 00 00 00 00	 mov	 DWORD PTR ?iCloudDX@@3HA, eax ; iCloudDX

; 110  : }

  00058	c3		 ret	 0
?SkyIslandInit@@YAXXZ ENDP				; SkyIslandInit
_TEXT	ENDS
; Function compile flags: /Ogtp
; File \\VBOXSVR\_stoneage\repos\ssm-sacli\system\SkyIsland.cpp
;	COMDAT ?LoadBmpToSurface@@YAXHPAUIDirectDrawSurface@@HH@Z
_TEXT	SEGMENT
_lpsurTo$GSCopy$1$ = -124				; size = 4
_i$1$ = -120						; size = 4
_h$GSCopy$1$ = -116					; size = 4
_ddsd$ = -112						; size = 108
__$ArrayPad$ = -4					; size = 4
_noFrom$ = 8						; size = 4
_lpsurTo$ = 12						; size = 4
_w$ = 16						; size = 4
_h$ = 20						; size = 4
?LoadBmpToSurface@@YAXHPAUIDirectDrawSurface@@HH@Z PROC	; LoadBmpToSurface, COMDAT

; 42   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 7c	 sub	 esp, 124		; 0000007cH
  00006	a1 00 00 00 00	 mov	 eax, DWORD PTR ___security_cookie
  0000b	33 c5		 xor	 eax, ebp
  0000d	89 45 fc	 mov	 DWORD PTR __$ArrayPad$[ebp], eax
  00010	8b 45 0c	 mov	 eax, DWORD PTR _lpsurTo$[ebp]
  00013	53		 push	 ebx
  00014	8b 5d 14	 mov	 ebx, DWORD PTR _h$[ebp]
  00017	56		 push	 esi
  00018	8b 75 10	 mov	 esi, DWORD PTR _w$[ebp]

; 43   : 	DDSURFACEDESC ddsd;
; 44   : 	ZeroMemory( &ddsd, sizeof(DDSURFACEDESC) );

  0001b	6a 68		 push	 104			; 00000068H
  0001d	89 45 84	 mov	 DWORD PTR _lpsurTo$GSCopy$1$[ebp], eax
  00020	8d 45 94	 lea	 eax, DWORD PTR _ddsd$[ebp+4]
  00023	6a 00		 push	 0
  00025	50		 push	 eax
  00026	89 5d 8c	 mov	 DWORD PTR _h$GSCopy$1$[ebp], ebx
  00029	e8 00 00 00 00	 call	 _memset

; 45   : 	ddsd.dwSize = sizeof(DDSURFACEDESC);
; 46   : 	if( lpsurTo->Lock( NULL, &ddsd, DDLOCK_WAIT, NULL) == DD_OK ){

  0002e	8b 4d 84	 mov	 ecx, DWORD PTR _lpsurTo$GSCopy$1$[ebp]
  00031	8d 55 90	 lea	 edx, DWORD PTR _ddsd$[ebp]
  00034	83 c4 0c	 add	 esp, 12			; 0000000cH
  00037	c7 45 90 6c 00
	00 00		 mov	 DWORD PTR _ddsd$[ebp], 108 ; 0000006cH
  0003e	8b 01		 mov	 eax, DWORD PTR [ecx]
  00040	6a 00		 push	 0
  00042	6a 01		 push	 1
  00044	52		 push	 edx
  00045	6a 00		 push	 0
  00047	51		 push	 ecx
  00048	ff 50 64	 call	 DWORD PTR [eax+100]
  0004b	85 c0		 test	 eax, eax
  0004d	0f 85 41 01 00
	00		 jne	 $LN17@LoadBmpToS

; 47   : 		if( realGetImage( 	noFrom, 

  00053	68 00 00 00 00	 push	 OFFSET ?RealBinHeight@@3HA ; RealBinHeight
  00058	68 00 00 00 00	 push	 OFFSET ?RealBinWidth@@3HA ; RealBinWidth
  0005d	68 00 00 00 00	 push	 OFFSET ?pRealBinBits@@3PADA ; pRealBinBits
  00062	ff 75 08	 push	 DWORD PTR _noFrom$[ebp]
  00065	e8 00 00 00 00	 call	 ?realGetImage@@YAHHPAPAEPAH1@Z ; realGetImage
  0006a	83 c4 10	 add	 esp, 16			; 00000010H
  0006d	85 c0		 test	 eax, eax
  0006f	0f 84 11 01 00
	00		 je	 $LN15@LoadBmpToS

; 48   : 							( unsigned char **)&pRealBinBits, 
; 49   : 							&RealBinWidth, 
; 50   : 							&RealBinHeight ) ){
; 51   : 			// realbin档图素要倒着读
; 52   : 			pRealBinBits += (w * (h-1));

  00075	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?pRealBinBits@@3PADA ; pRealBinBits
  0007b	8d 43 ff	 lea	 eax, DWORD PTR [ebx-1]
  0007e	0f af c6	 imul	 eax, esi
  00081	57		 push	 edi
  00082	03 d0		 add	 edx, eax

; 53   : 			if (displayBpp == 32){

  00084	a1 00 00 00 00	 mov	 eax, DWORD PTR ?displayBpp@@3HA ; displayBpp
  00089	89 15 00 00 00
	00		 mov	 DWORD PTR ?pRealBinBits@@3PADA, edx ; pRealBinBits
  0008f	83 f8 20	 cmp	 eax, 32			; 00000020H
  00092	75 51		 jne	 SHORT $LN19@LoadBmpToS

; 54   : 				LPDWORD surface;
; 55   : 				surface = (LPDWORD)ddsd.lpSurface;
; 56   : 				// 高彩一个点要用2个byte,所以pitch除2方便填颜色值
; 57   : 				ddsd.lPitch >>= 2; // ddsd.lPitch /= 2;

  00094	8b 4d a0	 mov	 ecx, DWORD PTR _ddsd$[ebp+16]
  00097	8b 7d b4	 mov	 edi, DWORD PTR _ddsd$[ebp+36]
  0009a	c1 f9 02	 sar	 ecx, 2
  0009d	89 4d a0	 mov	 DWORD PTR _ddsd$[ebp+16], ecx

; 58   : 				unsigned int pixel;
; 59   : 				for (int i = 0; i < h; i++){

  000a0	85 db		 test	 ebx, ebx
  000a2	0f 8e dd 00 00
	00		 jle	 $LN47@LoadBmpToS
$LL4@LoadBmpToS:

; 60   : 					for (int j = 0; j < w; j++){

  000a8	33 c0		 xor	 eax, eax
  000aa	85 f6		 test	 esi, esi
  000ac	7e 22		 jle	 SHORT $LN6@LoadBmpToS
  000ae	66 90		 npad	 2
$LL7@LoadBmpToS:

; 61   : 						pixel = highColor32Palette[(unsigned char)pRealBinBits[j]];

  000b0	0f b6 0c 02	 movzx	 ecx, BYTE PTR [edx+eax]
  000b4	8b 0c 8d 00 00
	00 00		 mov	 ecx, DWORD PTR ?highColor32Palette@@3PAIA[ecx*4]

; 62   : 						// 透明色不处理
; 63   : 						if (pixel) surface[j] = pixel;

  000bb	85 c9		 test	 ecx, ecx
  000bd	74 09		 je	 SHORT $LN5@LoadBmpToS
  000bf	89 0c 87	 mov	 DWORD PTR [edi+eax*4], ecx
  000c2	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?pRealBinBits@@3PADA ; pRealBinBits
$LN5@LoadBmpToS:

; 60   : 					for (int j = 0; j < w; j++){

  000c8	40		 inc	 eax
  000c9	3b c6		 cmp	 eax, esi
  000cb	7c e3		 jl	 SHORT $LL7@LoadBmpToS
  000cd	8b 4d a0	 mov	 ecx, DWORD PTR _ddsd$[ebp+16]
$LN6@LoadBmpToS:

; 64   : 					}
; 65   : 					// 换下一行
; 66   : 					surface += ddsd.lPitch;
; 67   : 					pRealBinBits -= w;

  000d0	2b d6		 sub	 edx, esi
  000d2	8d 3c 8f	 lea	 edi, DWORD PTR [edi+ecx*4]
  000d5	89 15 00 00 00
	00		 mov	 DWORD PTR ?pRealBinBits@@3PADA, edx ; pRealBinBits
  000db	83 eb 01	 sub	 ebx, 1
  000de	75 c8		 jne	 SHORT $LL4@LoadBmpToS

; 68   : 				}
; 69   : 			}else if( displayBpp == 16){

  000e0	e9 a0 00 00 00	 jmp	 $LN47@LoadBmpToS
$LN19@LoadBmpToS:
  000e5	83 f8 10	 cmp	 eax, 16			; 00000010H
  000e8	75 69		 jne	 SHORT $LN22@LoadBmpToS

; 70   : 				LPWORD surface;
; 71   : 				surface = (LPWORD)ddsd.lpSurface;
; 72   : 				// 高彩一个点要用2个byte,所以pitch除2方便填颜色值
; 73   : 				ddsd.lPitch >>= 1; // ddsd.lPitch /= 2;

  000ea	8b 4d a0	 mov	 ecx, DWORD PTR _ddsd$[ebp+16]
  000ed	33 c0		 xor	 eax, eax
  000ef	8b 5d b4	 mov	 ebx, DWORD PTR _ddsd$[ebp+36]
  000f2	d1 f9		 sar	 ecx, 1
  000f4	89 4d a0	 mov	 DWORD PTR _ddsd$[ebp+16], ecx
  000f7	89 45 88	 mov	 DWORD PTR _i$1$[ebp], eax

; 74   : 				unsigned short pixel;
; 75   : 				for( short i = 0; i < h; i++){

  000fa	39 45 8c	 cmp	 DWORD PTR _h$GSCopy$1$[ebp], eax
  000fd	0f 8e 82 00 00
	00		 jle	 $LN47@LoadBmpToS
$LL10@LoadBmpToS:

; 76   : 					for( short j = 0; j < w; j++){

  00103	33 ff		 xor	 edi, edi
  00105	85 f6		 test	 esi, esi
  00107	7e 30		 jle	 SHORT $LN12@LoadBmpToS
  00109	33 c9		 xor	 ecx, ecx
  0010b	0f 1f 44 00 00	 npad	 5
$LL13@LoadBmpToS:

; 77   : 						pixel = highColorPalette[(unsigned char)pRealBinBits[j]];

  00110	0f b6 04 11	 movzx	 eax, BYTE PTR [ecx+edx]
  00114	0f b7 04 45 00
	00 00 00	 movzx	 eax, WORD PTR ?highColorPalette@@3PAGA[eax*2]

; 78   : 						// 透明色不处理
; 79   : 						if( pixel) surface[j] = pixel;

  0011c	66 85 c0	 test	 ax, ax
  0011f	74 0a		 je	 SHORT $LN11@LoadBmpToS
  00121	66 89 04 4b	 mov	 WORD PTR [ebx+ecx*2], ax
  00125	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?pRealBinBits@@3PADA ; pRealBinBits
$LN11@LoadBmpToS:

; 76   : 					for( short j = 0; j < w; j++){

  0012b	47		 inc	 edi
  0012c	0f bf cf	 movsx	 ecx, di
  0012f	3b ce		 cmp	 ecx, esi
  00131	7c dd		 jl	 SHORT $LL13@LoadBmpToS
  00133	8b 4d a0	 mov	 ecx, DWORD PTR _ddsd$[ebp+16]
  00136	8b 45 88	 mov	 eax, DWORD PTR _i$1$[ebp]
$LN12@LoadBmpToS:

; 74   : 				unsigned short pixel;
; 75   : 				for( short i = 0; i < h; i++){

  00139	40		 inc	 eax

; 80   : 					}
; 81   : 					// 换下一行
; 82   : 					surface += ddsd.lPitch;

  0013a	8d 1c 4b	 lea	 ebx, DWORD PTR [ebx+ecx*2]
  0013d	89 45 88	 mov	 DWORD PTR _i$1$[ebp], eax

; 83   : 					pRealBinBits -= w;

  00140	2b d6		 sub	 edx, esi
  00142	98		 cwde
  00143	3b 45 8c	 cmp	 eax, DWORD PTR _h$GSCopy$1$[ebp]
  00146	8b 45 88	 mov	 eax, DWORD PTR _i$1$[ebp]
  00149	89 15 00 00 00
	00		 mov	 DWORD PTR ?pRealBinBits@@3PADA, edx ; pRealBinBits
  0014f	7c b2		 jl	 SHORT $LL10@LoadBmpToS

; 84   : 				}
; 85   : 			}else{

  00151	eb 32		 jmp	 SHORT $LN47@LoadBmpToS
$LN22@LoadBmpToS:

; 86   : 				LPBYTE surface;
; 87   : 				surface = (LPBYTE)ddsd.lpSurface;

  00153	8b 7d b4	 mov	 edi, DWORD PTR _ddsd$[ebp+36]
  00156	33 db		 xor	 ebx, ebx

; 88   : 				for( short i = 0; i < h; i++){

  00158	39 5d 8c	 cmp	 DWORD PTR _h$GSCopy$1$[ebp], ebx
  0015b	7e 28		 jle	 SHORT $LN47@LoadBmpToS
  0015d	0f 1f 00	 npad	 3
$LL16@LoadBmpToS:

; 89   : 					CopyMemory( surface, pRealBinBits, w);

  00160	56		 push	 esi
  00161	52		 push	 edx
  00162	57		 push	 edi
  00163	e8 00 00 00 00	 call	 _memcpy

; 90   : 					surface += ddsd.lPitch;
; 91   : 					pRealBinBits -= w;

  00168	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?pRealBinBits@@3PADA ; pRealBinBits
  0016e	43		 inc	 ebx
  0016f	03 7d a0	 add	 edi, DWORD PTR _ddsd$[ebp+16]
  00172	2b d6		 sub	 edx, esi
  00174	0f bf c3	 movsx	 eax, bx
  00177	83 c4 0c	 add	 esp, 12			; 0000000cH
  0017a	89 15 00 00 00
	00		 mov	 DWORD PTR ?pRealBinBits@@3PADA, edx ; pRealBinBits
  00180	3b 45 8c	 cmp	 eax, DWORD PTR _h$GSCopy$1$[ebp]
  00183	7c db		 jl	 SHORT $LL16@LoadBmpToS
$LN47@LoadBmpToS:
  00185	5f		 pop	 edi
$LN15@LoadBmpToS:

; 92   : 				}
; 93   : 			}
; 94   : 		}
; 95   : 		lpsurTo->Unlock( NULL);

  00186	8b 4d 84	 mov	 ecx, DWORD PTR _lpsurTo$GSCopy$1$[ebp]
  00189	6a 00		 push	 0
  0018b	51		 push	 ecx
  0018c	8b 01		 mov	 eax, DWORD PTR [ecx]
  0018e	ff 90 80 00 00
	00		 call	 DWORD PTR [eax+128]
$LN17@LoadBmpToS:

; 96   : 	}
; 97   : }

  00194	8b 4d fc	 mov	 ecx, DWORD PTR __$ArrayPad$[ebp]
  00197	5e		 pop	 esi
  00198	33 cd		 xor	 ecx, ebp
  0019a	5b		 pop	 ebx
  0019b	e8 00 00 00 00	 call	 @__security_check_cookie@4
  001a0	8b e5		 mov	 esp, ebp
  001a2	5d		 pop	 ebp
  001a3	c3		 ret	 0
?LoadBmpToSurface@@YAXHPAUIDirectDrawSurface@@HH@Z ENDP	; LoadBmpToSurface
_TEXT	ENDS
; Function compile flags: /Ogtp
; File \\VBOXSVR\_stoneage\repos\ssm-sacli\system\SkyIsland.cpp
;	COMDAT ?SkyIslandDraw@@YAXH@Z
_TEXT	SEGMENT
tv621 = -44						; size = 4
_h$2 = -44						; size = 2
_w$3 = -40						; size = 2
tv620 = -36						; size = 4
_no$4 = -36						; size = 4
_rc$ = -32						; size = 16
__$ArrayPad$ = -16					; size = 4
__$EHRec$ = -12						; size = 12
_floor$ = 8						; size = 4
?SkyIslandDraw@@YAXH@Z PROC				; SkyIslandDraw, COMDAT

; 280  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	6a ff		 push	 -1
  00005	68 00 00 00 00	 push	 __ehhandler$?SkyIslandDraw@@YAXH@Z
  0000a	64 a1 00 00 00
	00		 mov	 eax, DWORD PTR fs:0
  00010	50		 push	 eax
  00011	83 ec 20	 sub	 esp, 32			; 00000020H
  00014	a1 00 00 00 00	 mov	 eax, DWORD PTR ___security_cookie
  00019	33 c5		 xor	 eax, ebp
  0001b	89 45 f0	 mov	 DWORD PTR __$ArrayPad$[ebp], eax
  0001e	53		 push	 ebx
  0001f	56		 push	 esi
  00020	57		 push	 edi
  00021	50		 push	 eax
  00022	8d 45 f4	 lea	 eax, DWORD PTR __$EHRec$[ebp]
  00025	64 a3 00 00 00
	00		 mov	 DWORD PTR fs:0, eax

; 281  : 	static DWORD dwSlow1;
; 282  : //JL fix 2017.9.22 修复单人打精灵王后崩
; 283  : 	if (pc.ptAct == NULL){

  0002b	8b 15 ec 50 00
	00		 mov	 edx, DWORD PTR ?pc@@3UPC@@A+20716
  00031	85 d2		 test	 edx, edx
  00033	0f 84 bb 03 00
	00		 je	 $LN40@SkyIslandD

; 284  : 		return;
; 285  : 	}
; 286  : 	static int compx = (int)pc.ptAct->mx,compy = (int)pc.ptAct->my;

  00039	64 a1 00 00 00
	00		 mov	 eax, DWORD PTR fs:__tls_array
  0003f	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR __tls_index
  00045	8b 34 88	 mov	 esi, DWORD PTR [eax+ecx*4]
  00048	a1 00 00 00 00	 mov	 eax, DWORD PTR ?$TSS0@?1??SkyIslandDraw@@YAXH@Z@4HA
  0004d	3b 86 00 00 00
	00		 cmp	 eax, DWORD PTR __Init_thread_epoch[esi]
  00053	0f 8f b7 03 00
	00		 jg	 $LN58@SkyIslandD
  00059	eb 06		 jmp	 SHORT $LN2@SkyIslandD
$LN45@SkyIslandD:
  0005b	8b 15 ec 50 00
	00		 mov	 edx, DWORD PTR ?pc@@3UPC@@A+20716
$LN2@SkyIslandD:
  00061	a1 00 00 00 00	 mov	 eax, DWORD PTR ?$TSS1@?1??SkyIslandDraw@@YAXH@Z@4HA
  00066	3b 86 00 00 00
	00		 cmp	 eax, DWORD PTR __Init_thread_epoch[esi]
  0006c	0f 8f ea 03 00
	00		 jg	 $LN59@SkyIslandD
  00072	eb 06		 jmp	 SHORT $LN3@SkyIslandD
$LN46@SkyIslandD:

; 287  : 	int x,y;
; 288  : 	DWORD now;
; 289  : 	RECT rc;
; 290  : 
; 291  : 	if( sky_island_no && lpsurCloud1 && lpsurLand && pc.ptAct){

  00074	8b 15 ec 50 00
	00		 mov	 edx, DWORD PTR ?pc@@3UPC@@A+20716
$LN3@SkyIslandD:
  0007a	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?sky_island_no@@3KA, 0 ; sky_island_no
  00081	0f 84 6d 03 00
	00		 je	 $LN40@SkyIslandD
  00087	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?lpsurCloud1@@3PAUIDirectDrawSurface@@A, 0 ; lpsurCloud1
  0008e	0f 84 60 03 00
	00		 je	 $LN40@SkyIslandD
  00094	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?lpsurLand@@3PAUIDirectDrawSurface@@A, 0 ; lpsurLand
  0009b	0f 84 53 03 00
	00		 je	 $LN40@SkyIslandD
  000a1	85 d2		 test	 edx, edx
  000a3	0f 84 4b 03 00
	00		 je	 $LN40@SkyIslandD

; 292  : 		bDrawUpCloud = TRUE;

  000a9	c7 05 00 00 00
	00 01 00 00 00	 mov	 DWORD PTR ?bDrawUpCloud@@3HA, 1 ; bDrawUpCloud

; 293  : 		if(compx != (int)pc.ptAct->mx || compy != (int)pc.ptAct->my){

  000b3	f3 0f 2c 82 18
	01 00 00	 cvttss2si eax, DWORD PTR [edx+280]
  000bb	39 05 00 00 00
	00		 cmp	 DWORD PTR ?compx@?1??SkyIslandDraw@@YAXH@Z@4HA, eax
  000c1	75 10		 jne	 SHORT $LN11@SkyIslandD
  000c3	f3 0f 2c 82 1c
	01 00 00	 cvttss2si eax, DWORD PTR [edx+284]
  000cb	39 05 00 00 00
	00		 cmp	 DWORD PTR ?compy@?1??SkyIslandDraw@@YAXH@Z@4HA, eax
  000d1	74 6b		 je	 SHORT $LN10@SkyIslandD
$LN11@SkyIslandD:

; 294  : 			switch(pc.dir){

  000d3	a1 0c 00 00 00	 mov	 eax, DWORD PTR ?pc@@3UPC@@A+12
  000d8	83 f8 07	 cmp	 eax, 7
  000db	77 47		 ja	 SHORT $LN47@SkyIslandD
  000dd	ff 24 85 00 00
	00 00		 jmp	 DWORD PTR $LN44@SkyIslandD[eax*4]
$LN13@SkyIslandD:

; 295  : 			// 下
; 296  : 			case 0:	g_rc.top++; break;
; 297  : 			// 左下
; 298  : 			case 1:
; 299  : 				g_rc.left--;

  000e4	ff 0d 00 00 00
	00		 dec	 DWORD PTR ?g_rc@@3UtagRECT@@A

; 300  : 				g_rc.top++;
; 301  : 				break;

  000ea	eb 32		 jmp	 SHORT $LN12@SkyIslandD
$LN14@SkyIslandD:

; 302  : 			// 左
; 303  : 			case 2:	g_rc.left--; break;

  000ec	ff 0d 00 00 00
	00		 dec	 DWORD PTR ?g_rc@@3UtagRECT@@A
  000f2	eb 30		 jmp	 SHORT $LN47@SkyIslandD
$LN15@SkyIslandD:

; 304  : 			// 左上
; 305  : 			case 3:
; 306  : 				g_rc.left--;

  000f4	ff 0d 00 00 00
	00		 dec	 DWORD PTR ?g_rc@@3UtagRECT@@A
$LN16@SkyIslandD:

; 321  : 				g_rc.top++;
; 322  : 				break;
; 323  : 			}
; 324  : 			compx = (int)pc.ptAct->mx;

  000fa	ff 0d 04 00 00
	00		 dec	 DWORD PTR ?g_rc@@3UtagRECT@@A+4
  00100	eb 22		 jmp	 SHORT $LN47@SkyIslandD
$LN17@SkyIslandD:

; 307  : 				g_rc.top--;
; 308  : 				break;
; 309  : 			// 上
; 310  : 			case 4:	g_rc.top--; break;
; 311  : 			// 右上
; 312  : 			case 5:
; 313  : 				g_rc.left++;

  00102	ff 05 00 00 00
	00		 inc	 DWORD PTR ?g_rc@@3UtagRECT@@A

; 314  : 				g_rc.top--;

  00108	ff 0d 04 00 00
	00		 dec	 DWORD PTR ?g_rc@@3UtagRECT@@A+4

; 315  : 				break;

  0010e	eb 14		 jmp	 SHORT $LN47@SkyIslandD
$LN18@SkyIslandD:

; 316  : 			// 右
; 317  : 			case 6:	g_rc.left++; break;

  00110	ff 05 00 00 00
	00		 inc	 DWORD PTR ?g_rc@@3UtagRECT@@A
  00116	eb 0c		 jmp	 SHORT $LN47@SkyIslandD
$LN19@SkyIslandD:

; 318  : 			// 右下
; 319  : 			case 7:
; 320  : 				g_rc.left++;

  00118	ff 05 00 00 00
	00		 inc	 DWORD PTR ?g_rc@@3UtagRECT@@A
$LN12@SkyIslandD:

; 321  : 				g_rc.top++;
; 322  : 				break;
; 323  : 			}
; 324  : 			compx = (int)pc.ptAct->mx;

  0011e	ff 05 04 00 00
	00		 inc	 DWORD PTR ?g_rc@@3UtagRECT@@A+4
$LN47@SkyIslandD:
  00124	f3 0f 2c 82 18
	01 00 00	 cvttss2si eax, DWORD PTR [edx+280]
  0012c	a3 00 00 00 00	 mov	 DWORD PTR ?compx@?1??SkyIslandDraw@@YAXH@Z@4HA, eax

; 325  : 			compy = (int)pc.ptAct->my;

  00131	f3 0f 2c 82 1c
	01 00 00	 cvttss2si eax, DWORD PTR [edx+284]
  00139	a3 00 00 00 00	 mov	 DWORD PTR ?compy@?1??SkyIslandDraw@@YAXH@Z@4HA, eax
$LN10@SkyIslandD:

; 326  : 		}
; 327  : 		g_rc.right = g_rc.left + DEF_APPSIZEX;
; 328  : 		g_rc.bottom = g_rc.top + DEF_APPSIZEY;

  0013e	8b 0d 04 00 00
	00		 mov	 ecx, DWORD PTR ?g_rc@@3UtagRECT@@A+4
  00144	a1 00 00 00 00	 mov	 eax, DWORD PTR ?DEF_APPSIZEY@@3HA ; DEF_APPSIZEY
  00149	8b 35 00 00 00
	00		 mov	 esi, DWORD PTR ?g_rc@@3UtagRECT@@A
  0014f	03 c1		 add	 eax, ecx
  00151	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?DEF_APPSIZEX@@3HA ; DEF_APPSIZEX

; 329  : 		SetRect(&rc,g_rc.left,g_rc.top,g_rc.right,g_rc.bottom);

  00157	8b 1d 00 00 00
	00		 mov	 ebx, DWORD PTR __imp__SetRect@20
  0015d	03 d6		 add	 edx, esi
  0015f	50		 push	 eax
  00160	52		 push	 edx
  00161	51		 push	 ecx
  00162	a3 0c 00 00 00	 mov	 DWORD PTR ?g_rc@@3UtagRECT@@A+12, eax
  00167	8d 45 e0	 lea	 eax, DWORD PTR _rc$[ebp]
  0016a	56		 push	 esi
  0016b	50		 push	 eax
  0016c	89 15 08 00 00
	00		 mov	 DWORD PTR ?g_rc@@3UtagRECT@@A+8, edx
  00172	ff d3		 call	 ebx

; 330  : 		if(g_rc.left < 0){

  00174	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?g_rc@@3UtagRECT@@A, 0
  0017b	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?DEF_APPSIZEX@@3HA ; DEF_APPSIZEX
  00181	7d 0a		 jge	 SHORT $LN20@SkyIslandD

; 331  : 			rc.left = 0;

  00183	c7 45 e0 00 00
	00 00		 mov	 DWORD PTR _rc$[ebp], 0

; 332  : 			rc.right = rc.left + DEF_APPSIZEX;

  0018a	89 55 e8	 mov	 DWORD PTR _rc$[ebp+8], edx
$LN20@SkyIslandD:

; 333  : 		}
; 334  : 		if(g_rc.top < 0){

  0018d	83 3d 04 00 00
	00 00		 cmp	 DWORD PTR ?g_rc@@3UtagRECT@@A+4, 0
  00194	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?DEF_APPSIZEY@@3HA ; DEF_APPSIZEY
  0019a	7d 0a		 jge	 SHORT $LN21@SkyIslandD

; 335  : 			rc.top = 0;

  0019c	c7 45 e4 00 00
	00 00		 mov	 DWORD PTR _rc$[ebp+4], 0

; 336  : 			rc.bottom = rc.top + DEF_APPSIZEY;

  001a3	89 4d ec	 mov	 DWORD PTR _rc$[ebp+12], ecx
$LN21@SkyIslandD:

; 337  : 		}
; 338  : 		if(g_rc.right > LandWidth){

  001a6	0f bf 05 00 00
	00 00		 movsx	 eax, WORD PTR ?LandWidth@@3FA ; LandWidth
  001ad	39 05 08 00 00
	00		 cmp	 DWORD PTR ?g_rc@@3UtagRECT@@A+8, eax
  001b3	7e 08		 jle	 SHORT $LN22@SkyIslandD

; 339  : 			rc.right = LandWidth;

  001b5	89 45 e8	 mov	 DWORD PTR _rc$[ebp+8], eax

; 340  : 			rc.left = LandWidth - DEF_APPSIZEX;

  001b8	2b c2		 sub	 eax, edx
  001ba	89 45 e0	 mov	 DWORD PTR _rc$[ebp], eax
$LN22@SkyIslandD:

; 341  : 		}
; 342  : 		if(g_rc.bottom > LandHeight){

  001bd	0f bf 05 00 00
	00 00		 movsx	 eax, WORD PTR ?LandHeight@@3FA ; LandHeight
  001c4	39 05 0c 00 00
	00		 cmp	 DWORD PTR ?g_rc@@3UtagRECT@@A+12, eax
  001ca	7e 08		 jle	 SHORT $LN23@SkyIslandD

; 343  : 			rc.bottom = LandHeight;

  001cc	89 45 ec	 mov	 DWORD PTR _rc$[ebp+12], eax

; 344  : 			rc.top = LandHeight - DEF_APPSIZEY;

  001cf	2b c1		 sub	 eax, ecx
  001d1	89 45 e4	 mov	 DWORD PTR _rc$[ebp+4], eax
$LN23@SkyIslandD:

; 345  : 		}
; 346  : 		lpDraw->lpBACKBUFFER->BltFast( 0, 0, lpsurLand, &rc, DDBLTFAST_WAIT);	

  001d4	a1 00 00 00 00	 mov	 eax, DWORD PTR ?lpDraw@@3PAUDIRECT_DRAW@@A ; lpDraw
  001d9	8d 55 e0	 lea	 edx, DWORD PTR _rc$[ebp]
  001dc	6a 10		 push	 16			; 00000010H
  001de	52		 push	 edx
  001df	ff 35 00 00 00
	00		 push	 DWORD PTR ?lpsurLand@@3PAUIDirectDrawSurface@@A ; lpsurLand
  001e5	8b 40 0c	 mov	 eax, DWORD PTR [eax+12]
  001e8	6a 00		 push	 0
  001ea	6a 00		 push	 0
  001ec	50		 push	 eax
  001ed	8b 08		 mov	 ecx, DWORD PTR [eax]
  001ef	ff 51 1c	 call	 DWORD PTR [ecx+28]

; 347  : #ifdef _READ16BITBMP
; 348  : 		if(g_bUseAlpha) lpDraw->lpBACKBUFFERSYS->BltFast( 0, 0, lpsurLand, &rc, DDBLTFAST_WAIT);	
; 349  : #endif
; 350  : #ifdef _MOON_FAIRYLAND				// (不可开) ROG ADD 月之仙境
; 351  : 		if(moonFlag == TRUE) return;

  001f2	83 3d 00 00 00
	00 01		 cmp	 DWORD PTR ?moonFlag@@3HA, 1 ; moonFlag
  001f9	0f 84 f5 01 00
	00		 je	 $LN40@SkyIslandD

; 352  : #endif
; 353  : 
; 354  : 		if( (now = TimeGetTime()) > dwSlow1){

  001ff	e8 00 00 00 00	 call	 ?TimeGetTime@@YAIXZ	; TimeGetTime
  00204	8b 35 00 00 00
	00		 mov	 esi, DWORD PTR ?iCloudX1@@3HA ; iCloudX1
  0020a	3b 05 00 00 00
	00		 cmp	 eax, DWORD PTR ?dwSlow1@?1??SkyIslandDraw@@YAXH@Z@4KA
  00210	0f 86 23 01 00
	00		 jbe	 $LN50@SkyIslandD

; 355  : 			dwSlow1 = now + 177;
; 356  : 			iCloudX1 += iCloudDX;

  00216	03 35 00 00 00
	00		 add	 esi, DWORD PTR ?iCloudDX@@3HA ; iCloudDX
  0021c	05 b1 00 00 00	 add	 eax, 177		; 000000b1H

; 357  : 			iCloudY1 += iCloudDY;

  00221	8b 3d 00 00 00
	00		 mov	 edi, DWORD PTR ?iCloudDY@@3HA ; iCloudDY
  00227	03 3d 00 00 00
	00		 add	 edi, DWORD PTR ?iCloudY1@@3HA ; iCloudY1
  0022d	a3 00 00 00 00	 mov	 DWORD PTR ?dwSlow1@?1??SkyIslandDraw@@YAXH@Z@4KA, eax
  00232	89 35 00 00 00
	00		 mov	 DWORD PTR ?iCloudX1@@3HA, esi ; iCloudX1
  00238	89 3d 00 00 00
	00		 mov	 DWORD PTR ?iCloudY1@@3HA, edi ; iCloudY1
  0023e	3b 35 00 00 00
	00		 cmp	 esi, DWORD PTR ?DEF_APPSIZEX@@3HA ; DEF_APPSIZEX

; 358  : 			if(((iCloudX1>=DEF_APPSIZEX) || (iCloudY1>=DEF_APPSIZEY)) ){

  00244	7d 0c		 jge	 SHORT $LN27@SkyIslandD
  00246	3b 3d 00 00 00
	00		 cmp	 edi, DWORD PTR ?DEF_APPSIZEY@@3HA ; DEF_APPSIZEY
  0024c	0f 8c ed 00 00
	00		 jl	 $LN26@SkyIslandD
$LN27@SkyIslandD:

; 359  : 				//产生一朵新的云
; 360  : #ifdef __CARYTEST
; 361  : 				iCloudNo1 = 40500+(rand()&0x3);
; 362  : 				DWORD no;
; 363  : 				short w, h;
; 364  : 				realGetNo( iCloudNo1, &no);
; 365  : 				realGetWH( no, &w, &h);
; 366  : 				CloudWidth1 = w;
; 367  : 				CloudHeight1 = h;
; 368  : #else
; 369  : 				DWORD no;
; 370  : 				short w, h;
; 371  : #ifdef _NEW_CLOUD
; 372  : 				if( floor == 61000 || floor == 61100 )

  00252	8b 45 08	 mov	 eax, DWORD PTR _floor$[ebp]
  00255	3d 48 ee 00 00	 cmp	 eax, 61000		; 0000ee48H
  0025a	74 16		 je	 SHORT $LN30@SkyIslandD
  0025c	3d ac ee 00 00	 cmp	 eax, 61100		; 0000eeacH
  00261	74 0f		 je	 SHORT $LN30@SkyIslandD

; 374  : 				else
; 375  : 					realGetNo( 40500+(rand()&0x3), &no);

  00263	e8 00 00 00 00	 call	 _rand
  00268	83 e0 03	 and	 eax, 3
  0026b	05 34 9e 00 00	 add	 eax, 40500		; 00009e34H
  00270	eb 16		 jmp	 SHORT $LN29@SkyIslandD
$LN30@SkyIslandD:

; 373  : 					realGetNo( 29077+(rand()%2), &no);

  00272	e8 00 00 00 00	 call	 _rand
  00277	25 01 00 00 80	 and	 eax, -2147483647	; 80000001H
  0027c	79 05		 jns	 SHORT $LN56@SkyIslandD
  0027e	48		 dec	 eax
  0027f	83 c8 fe	 or	 eax, -2			; fffffffeH
  00282	40		 inc	 eax
$LN56@SkyIslandD:
  00283	05 95 71 00 00	 add	 eax, 29077		; 00007195H
$LN29@SkyIslandD:

; 376  : #else
; 377  : 				realGetNo( 40500+(rand()&0x3), &no);
; 378  : #endif
; 379  : 				realGetWH( no, &w, &h);

  00288	8d 4d dc	 lea	 ecx, DWORD PTR _no$4[ebp]
  0028b	51		 push	 ecx
  0028c	50		 push	 eax
  0028d	e8 00 00 00 00	 call	 ?realGetNo@@YAHKPAK@Z	; realGetNo
  00292	8d 45 d4	 lea	 eax, DWORD PTR _h$2[ebp]
  00295	50		 push	 eax
  00296	8d 45 d8	 lea	 eax, DWORD PTR _w$3[ebp]
  00299	50		 push	 eax
  0029a	ff 75 dc	 push	 DWORD PTR _no$4[ebp]
  0029d	e8 00 00 00 00	 call	 ?realGetWH@@YAHKPAF0@Z	; realGetWH

; 380  : 				if( w!=CloudWidth1 || h!=CloudHeight1){

  002a2	66 8b 4d d8	 mov	 cx, WORD PTR _w$3[ebp]
  002a6	83 c4 14	 add	 esp, 20			; 00000014H
  002a9	66 8b 45 d4	 mov	 ax, WORD PTR _h$2[ebp]
  002ad	66 3b 0d 00 00
	00 00		 cmp	 cx, WORD PTR ?CloudWidth1@@3FA ; CloudWidth1
  002b4	75 09		 jne	 SHORT $LN32@SkyIslandD
  002b6	66 3b 05 00 00
	00 00		 cmp	 ax, WORD PTR ?CloudHeight1@@3FA ; CloudHeight1
  002bd	74 24		 je	 SHORT $LN31@SkyIslandD
$LN32@SkyIslandD:

; 381  : 					CloudWidth1 = w;
; 382  : 					CloudHeight1 = h;

  002bf	66 a3 00 00 00
	00		 mov	 WORD PTR ?CloudHeight1@@3FA, ax ; CloudHeight1

; 383  : 					LoadBmpToSurface( no, lpsurCloud1, w, h);

  002c5	98		 cwde
  002c6	50		 push	 eax
  002c7	0f bf c1	 movsx	 eax, cx
  002ca	50		 push	 eax
  002cb	ff 35 00 00 00
	00		 push	 DWORD PTR ?lpsurCloud1@@3PAUIDirectDrawSurface@@A ; lpsurCloud1
  002d1	66 89 0d 00 00
	00 00		 mov	 WORD PTR ?CloudWidth1@@3FA, cx ; CloudWidth1
  002d8	ff 75 dc	 push	 DWORD PTR _no$4[ebp]
  002db	e8 00 00 00 00	 call	 ?LoadBmpToSurface@@YAXHPAUIDirectDrawSurface@@HH@Z ; LoadBmpToSurface
  002e0	83 c4 10	 add	 esp, 16			; 00000010H
$LN31@SkyIslandD:

; 384  : 				}
; 385  : #endif
; 386  : 				int dx = 0, dy = 0;

  002e3	33 f6		 xor	 esi, esi
  002e5	33 ff		 xor	 edi, edi

; 387  : 				switch( rand()%3){

  002e7	e8 00 00 00 00	 call	 _rand
  002ec	99		 cdq
  002ed	b9 03 00 00 00	 mov	 ecx, 3
  002f2	f7 f9		 idiv	 ecx
  002f4	2b d6		 sub	 edx, esi
  002f6	74 11		 je	 SHORT $LN33@SkyIslandD
  002f8	83 ea 01	 sub	 edx, 1
  002fb	75 16		 jne	 SHORT $LN35@SkyIslandD

; 390  : 					break;
; 391  : 				case 1:
; 392  : 					dy = rand() & 0x1f;

  002fd	e8 00 00 00 00	 call	 _rand
  00302	8b f8		 mov	 edi, eax
  00304	83 e7 1f	 and	 edi, 31			; 0000001fH

; 393  : 					break;

  00307	eb 0a		 jmp	 SHORT $LN35@SkyIslandD
$LN33@SkyIslandD:

; 388  : 				case 0:
; 389  : 					dx = rand() & 0x1f;

  00309	e8 00 00 00 00	 call	 _rand
  0030e	8b f0		 mov	 esi, eax
  00310	83 e6 1f	 and	 esi, 31			; 0000001fH
$LN35@SkyIslandD:

; 394  : 				default:
; 395  : 					break;
; 396  : 				}
; 397  : 				iCloudX1 = -CloudWidth1 + dx + 40;

  00313	0f bf 0d 00 00
	00 00		 movsx	 ecx, WORD PTR ?CloudWidth1@@3FA ; CloudWidth1

; 398  : 				iCloudY1 = -CloudHeight1 + dy + 30;

  0031a	0f bf 05 00 00
	00 00		 movsx	 eax, WORD PTR ?CloudHeight1@@3FA ; CloudHeight1
  00321	2b f1		 sub	 esi, ecx
  00323	83 c6 28	 add	 esi, 40			; 00000028H
  00326	2b f8		 sub	 edi, eax
  00328	83 c7 1e	 add	 edi, 30			; 0000001eH
  0032b	89 35 00 00 00
	00		 mov	 DWORD PTR ?iCloudX1@@3HA, esi ; iCloudX1
  00331	89 3d 00 00 00
	00		 mov	 DWORD PTR ?iCloudY1@@3HA, edi ; iCloudY1
  00337	eb 06		 jmp	 SHORT $LN26@SkyIslandD
$LN50@SkyIslandD:

; 352  : #endif
; 353  : 
; 354  : 		if( (now = TimeGetTime()) > dwSlow1){

  00339	8b 3d 00 00 00
	00		 mov	 edi, DWORD PTR ?iCloudY1@@3HA ; iCloudY1
$LN26@SkyIslandD:

; 399  : 			}
; 400  : 		}
; 401  : 	//		int x, y;
; 402  : 			x = iCloudX1;
; 403  : 			y = iCloudY1;
; 404  : 			SetRect( &rc, 0, 0, CloudWidth1, CloudHeight1);

  0033f	0f bf 05 00 00
	00 00		 movsx	 eax, WORD PTR ?CloudHeight1@@3FA ; CloudHeight1
  00346	50		 push	 eax
  00347	0f bf 05 00 00
	00 00		 movsx	 eax, WORD PTR ?CloudWidth1@@3FA ; CloudWidth1
  0034e	50		 push	 eax
  0034f	6a 00		 push	 0
  00351	6a 00		 push	 0
  00353	8d 45 e0	 lea	 eax, DWORD PTR _rc$[ebp]
  00356	50		 push	 eax
  00357	ff d3		 call	 ebx

; 405  : 			if( x < 0){

  00359	85 f6		 test	 esi, esi
  0035b	79 09		 jns	 SHORT $LN51@SkyIslandD

; 406  : 				rc.left = -x;

  0035d	8b de		 mov	 ebx, esi
  0035f	f7 db		 neg	 ebx
  00361	89 5d e0	 mov	 DWORD PTR _rc$[ebp], ebx
  00364	eb 03		 jmp	 SHORT $LN36@SkyIslandD
$LN51@SkyIslandD:

; 405  : 			if( x < 0){

  00366	8b 5d e0	 mov	 ebx, DWORD PTR _rc$[ebp]
$LN36@SkyIslandD:

; 407  : 				x = 0;
; 408  : 			}
; 409  : 			if( (x+CloudWidth1) >= DEF_APPSIZEX){

  00369	0f bf 05 00 00
	00 00		 movsx	 eax, WORD PTR ?CloudWidth1@@3FA ; CloudWidth1
  00370	33 d2		 xor	 edx, edx
  00372	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?DEF_APPSIZEX@@3HA ; DEF_APPSIZEX
  00378	85 f6		 test	 esi, esi
  0037a	0f 49 d6	 cmovns	 edx, esi
  0037d	03 c2		 add	 eax, edx
  0037f	89 55 d4	 mov	 DWORD PTR tv621[ebp], edx
  00382	3b c1		 cmp	 eax, ecx
  00384	7c 07		 jl	 SHORT $LN52@SkyIslandD

; 410  : 				rc.right = DEF_APPSIZEX - x;

  00386	2b ca		 sub	 ecx, edx
  00388	89 4d e8	 mov	 DWORD PTR _rc$[ebp+8], ecx
  0038b	eb 03		 jmp	 SHORT $LN37@SkyIslandD
$LN52@SkyIslandD:

; 407  : 				x = 0;
; 408  : 			}
; 409  : 			if( (x+CloudWidth1) >= DEF_APPSIZEX){

  0038d	8b 4d e8	 mov	 ecx, DWORD PTR _rc$[ebp+8]
$LN37@SkyIslandD:

; 411  : 			}
; 412  : 			if( y < 0){

  00390	85 ff		 test	 edi, edi
  00392	79 09		 jns	 SHORT $LN53@SkyIslandD

; 413  : 				rc.top = -y;

  00394	8b f7		 mov	 esi, edi
  00396	f7 de		 neg	 esi
  00398	89 75 e4	 mov	 DWORD PTR _rc$[ebp+4], esi
  0039b	eb 03		 jmp	 SHORT $LN38@SkyIslandD
$LN53@SkyIslandD:

; 411  : 			}
; 412  : 			if( y < 0){

  0039d	8b 75 e4	 mov	 esi, DWORD PTR _rc$[ebp+4]
$LN38@SkyIslandD:

; 414  : 				y = 0;
; 415  : 			}
; 416  : 			if( (y+CloudHeight1) >= DEF_APPSIZEY){

  003a0	0f bf 05 00 00
	00 00		 movsx	 eax, WORD PTR ?CloudHeight1@@3FA ; CloudHeight1
  003a7	33 d2		 xor	 edx, edx
  003a9	85 ff		 test	 edi, edi
  003ab	0f 49 d7	 cmovns	 edx, edi
  003ae	89 55 dc	 mov	 DWORD PTR tv620[ebp], edx
  003b1	03 c2		 add	 eax, edx
  003b3	8b 15 00 00 00
	00		 mov	 edx, DWORD PTR ?DEF_APPSIZEY@@3HA ; DEF_APPSIZEY
  003b9	8b 7d dc	 mov	 edi, DWORD PTR tv620[ebp]
  003bc	3b c2		 cmp	 eax, edx
  003be	7c 07		 jl	 SHORT $LN54@SkyIslandD

; 417  : 				rc.bottom = DEF_APPSIZEY -y;

  003c0	2b d7		 sub	 edx, edi
  003c2	89 55 ec	 mov	 DWORD PTR _rc$[ebp+12], edx
  003c5	eb 03		 jmp	 SHORT $LN39@SkyIslandD
$LN54@SkyIslandD:

; 414  : 				y = 0;
; 415  : 			}
; 416  : 			if( (y+CloudHeight1) >= DEF_APPSIZEY){

  003c7	8b 55 ec	 mov	 edx, DWORD PTR _rc$[ebp+12]
$LN39@SkyIslandD:

; 418  : 			}
; 419  : 			if( (rc.bottom-rc.top)>0 && (rc.right-rc.left)>0){

  003ca	2b d6		 sub	 edx, esi
  003cc	85 d2		 test	 edx, edx
  003ce	7e 24		 jle	 SHORT $LN40@SkyIslandD
  003d0	2b cb		 sub	 ecx, ebx
  003d2	85 c9		 test	 ecx, ecx
  003d4	7e 1e		 jle	 SHORT $LN40@SkyIslandD

; 420  : 				lpDraw->lpBACKBUFFER->BltFast( x, y, lpsurCloud1, &rc, DDBLTFAST_WAIT|DDBLTFAST_SRCCOLORKEY);

  003d6	a1 00 00 00 00	 mov	 eax, DWORD PTR ?lpDraw@@3PAUDIRECT_DRAW@@A ; lpDraw
  003db	8d 55 e0	 lea	 edx, DWORD PTR _rc$[ebp]
  003de	6a 11		 push	 17			; 00000011H
  003e0	52		 push	 edx
  003e1	ff 35 00 00 00
	00		 push	 DWORD PTR ?lpsurCloud1@@3PAUIDirectDrawSurface@@A ; lpsurCloud1
  003e7	8b 40 0c	 mov	 eax, DWORD PTR [eax+12]
  003ea	57		 push	 edi
  003eb	ff 75 d4	 push	 DWORD PTR tv621[ebp]
  003ee	8b 08		 mov	 ecx, DWORD PTR [eax]
  003f0	50		 push	 eax
  003f1	ff 51 1c	 call	 DWORD PTR [ecx+28]
$LN40@SkyIslandD:

; 421  : #ifdef _READ16BITBMP
; 422  : 				if(g_bUseAlpha) lpDraw->lpBACKBUFFERSYS->BltFast( x, y, lpsurCloud1, &rc, DDBLTFAST_WAIT|DDBLTFAST_SRCCOLORKEY);
; 423  : #endif
; 424  : 
; 425  : 		}
; 426  : 	}
; 427  : }

  003f4	8b 4d f4	 mov	 ecx, DWORD PTR __$EHRec$[ebp]
  003f7	64 89 0d 00 00
	00 00		 mov	 DWORD PTR fs:0, ecx
  003fe	59		 pop	 ecx
  003ff	5f		 pop	 edi
  00400	5e		 pop	 esi
  00401	5b		 pop	 ebx
  00402	8b 4d f0	 mov	 ecx, DWORD PTR __$ArrayPad$[ebp]
  00405	33 cd		 xor	 ecx, ebp
  00407	e8 00 00 00 00	 call	 @__security_check_cookie@4
  0040c	8b e5		 mov	 esp, ebp
  0040e	5d		 pop	 ebp
  0040f	c3		 ret	 0
$LN58@SkyIslandD:

; 284  : 		return;
; 285  : 	}
; 286  : 	static int compx = (int)pc.ptAct->mx,compy = (int)pc.ptAct->my;

  00410	68 00 00 00 00	 push	 OFFSET ?$TSS0@?1??SkyIslandDraw@@YAXH@Z@4HA
  00415	e8 00 00 00 00	 call	 __Init_thread_header
  0041a	83 c4 04	 add	 esp, 4
  0041d	83 3d 00 00 00
	00 ff		 cmp	 DWORD PTR ?$TSS0@?1??SkyIslandDraw@@YAXH@Z@4HA, -1
  00424	0f 85 31 fc ff
	ff		 jne	 $LN45@SkyIslandD
  0042a	c7 45 fc 00 00
	00 00		 mov	 DWORD PTR __$EHRec$[ebp+8], 0
  00431	a1 ec 50 00 00	 mov	 eax, DWORD PTR ?pc@@3UPC@@A+20716
  00436	f3 0f 2c 80 18
	01 00 00	 cvttss2si eax, DWORD PTR [eax+280]
  0043e	a3 00 00 00 00	 mov	 DWORD PTR ?compx@?1??SkyIslandDraw@@YAXH@Z@4HA, eax
  00443	c7 45 fc ff ff
	ff ff		 mov	 DWORD PTR __$EHRec$[ebp+8], -1
  0044a	68 00 00 00 00	 push	 OFFSET ?$TSS0@?1??SkyIslandDraw@@YAXH@Z@4HA
  0044f	e8 00 00 00 00	 call	 __Init_thread_footer
  00454	83 c4 04	 add	 esp, 4
  00457	e9 ff fb ff ff	 jmp	 $LN45@SkyIslandD
$LN59@SkyIslandD:
  0045c	68 00 00 00 00	 push	 OFFSET ?$TSS1@?1??SkyIslandDraw@@YAXH@Z@4HA
  00461	e8 00 00 00 00	 call	 __Init_thread_header
  00466	83 c4 04	 add	 esp, 4
  00469	83 3d 00 00 00
	00 ff		 cmp	 DWORD PTR ?$TSS1@?1??SkyIslandDraw@@YAXH@Z@4HA, -1
  00470	0f 85 fe fb ff
	ff		 jne	 $LN46@SkyIslandD
  00476	c7 45 fc 01 00
	00 00		 mov	 DWORD PTR __$EHRec$[ebp+8], 1
  0047d	a1 ec 50 00 00	 mov	 eax, DWORD PTR ?pc@@3UPC@@A+20716
  00482	f3 0f 2c 80 1c
	01 00 00	 cvttss2si eax, DWORD PTR [eax+284]
  0048a	a3 00 00 00 00	 mov	 DWORD PTR ?compy@?1??SkyIslandDraw@@YAXH@Z@4HA, eax
  0048f	c7 45 fc ff ff
	ff ff		 mov	 DWORD PTR __$EHRec$[ebp+8], -1
  00496	68 00 00 00 00	 push	 OFFSET ?$TSS1@?1??SkyIslandDraw@@YAXH@Z@4HA
  0049b	e8 00 00 00 00	 call	 __Init_thread_footer
  004a0	83 c4 04	 add	 esp, 4
  004a3	e9 cc fb ff ff	 jmp	 $LN46@SkyIslandD
$LN44@SkyIslandD:

; 421  : #ifdef _READ16BITBMP
; 422  : 				if(g_bUseAlpha) lpDraw->lpBACKBUFFERSYS->BltFast( x, y, lpsurCloud1, &rc, DDBLTFAST_WAIT|DDBLTFAST_SRCCOLORKEY);
; 423  : #endif
; 424  : 
; 425  : 		}
; 426  : 	}
; 427  : }

  004a8	00 00 00 00	 DD	 $LN12@SkyIslandD
  004ac	00 00 00 00	 DD	 $LN13@SkyIslandD
  004b0	00 00 00 00	 DD	 $LN14@SkyIslandD
  004b4	00 00 00 00	 DD	 $LN15@SkyIslandD
  004b8	00 00 00 00	 DD	 $LN16@SkyIslandD
  004bc	00 00 00 00	 DD	 $LN17@SkyIslandD
  004c0	00 00 00 00	 DD	 $LN18@SkyIslandD
  004c4	00 00 00 00	 DD	 $LN19@SkyIslandD
_TEXT	ENDS
;	COMDAT text$x
text$x	SEGMENT
__unwindfunclet$?SkyIslandDraw@@YAXH@Z$0:
  00000	68 00 00 00 00	 push	 OFFSET ?$TSS0@?1??SkyIslandDraw@@YAXH@Z@4HA
  00005	e8 00 00 00 00	 call	 __Init_thread_abort
  0000a	59		 pop	 ecx
  0000b	c3		 ret	 0
__unwindfunclet$?SkyIslandDraw@@YAXH@Z$1:
  0000c	68 00 00 00 00	 push	 OFFSET ?$TSS1@?1??SkyIslandDraw@@YAXH@Z@4HA
  00011	e8 00 00 00 00	 call	 __Init_thread_abort
  00016	59		 pop	 ecx
  00017	c3		 ret	 0
  00018	cc		 int	 3
  00019	cc		 int	 3
  0001a	cc		 int	 3
  0001b	cc		 int	 3
  0001c	cc		 int	 3
__ehhandler$?SkyIslandDraw@@YAXH@Z:
  0001d	90		 npad	 1
  0001e	90		 npad	 1
  0001f	8b 54 24 08	 mov	 edx, DWORD PTR [esp+8]
  00023	8d 42 0c	 lea	 eax, DWORD PTR [edx+12]
  00026	8b 4a d0	 mov	 ecx, DWORD PTR [edx-48]
  00029	33 c8		 xor	 ecx, eax
  0002b	e8 00 00 00 00	 call	 @__security_check_cookie@4
  00030	8b 4a fc	 mov	 ecx, DWORD PTR [edx-4]
  00033	33 c8		 xor	 ecx, eax
  00035	e8 00 00 00 00	 call	 @__security_check_cookie@4
  0003a	b8 00 00 00 00	 mov	 eax, OFFSET __ehfuncinfo$?SkyIslandDraw@@YAXH@Z
  0003f	e9 00 00 00 00	 jmp	 ___CxxFrameHandler3
text$x	ENDS
?SkyIslandDraw@@YAXH@Z ENDP				; SkyIslandDraw
END
